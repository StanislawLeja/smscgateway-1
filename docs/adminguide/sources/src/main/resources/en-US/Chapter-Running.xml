<?xml version='1.0'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "${ent.filename}">
%BOOK_ENTITIES;
]>

<chapter id="running">

	<title>Running</title>
	
	<section id="running_the_gateway">
		<title>Running the Gateway</title>
			<procedure>
				<title>Run &THIS.PLATFORM; &THIS.APPLICATION;</title>
				<step><para>Pre-requisite: </para>
					 <substeps>
						<step><para>You must have &THIS.PLATFORM; &THIS.APPLICATION; installed as explained in the Installation Guide.</para>
						</step>	
						<step><para>If you are using the SS7 board on server, you must ensure that the <literal>java.library.path</literal> variable is set to point to the directory containing the native component. Alternatively you can copy it to the JBoss native library path manually.</para></step>
						<step><para>You must have Cassandra database running and configured as explained in the Installation Guide.</para></step>
					</substeps>
				</step>
				<step>
					<para>All you have to do to start the Gateway is start the JBoss Application Server. To start the JBoss Server you must execute the <filename>run.sh</filename> (Unix) or <filename>run.bat</filename> (Microsoft Windows)
					startup script in the <filename>telscale-smscgateway-6.1.1.GA/jboss-5.1.0.GA/bin</filename> folder (on Unix or Windows). Note that this will start the server in the default profile. The "default" profile is a clean profile where you will have to start from scratch and configure the entire SS7 Stack and SMSC Gateway.
					</para>
				</step>
				<step><para>Result: If the service started properly you should see the following last few output lines in the Unix terminal or Command Prompt depending on your environment:
	<screen><![CDATA[
2013-07-22 17:41:48,817 INFO [org.mobicents.slee.container.management.ResourceManagement] (pool-27-thread-1) Created Resource Adaptor Entity SmppServerRA for ResourceAdaptorID[name=SMPPServerResourceAdaptor,vendor=org.mobicents,version=1.0] Config Properties: [] 
2013-07-22 17:41:49,067 INFO [org.mobicents.slee.container.management.ResourceManagement] (pool-27-thread-1) Activated RA Entity SmppServerRA 2013-07-22 17:41:49,317 INFO [org.mobicents.slee.container.management.ResourceManagement] (pool-27-thread-1) Bound link between RA Entity SmppServerRA and Name SmppServerRA 
2013-07-22 17:41:49,615 INFO [javax.slee.RAEntityNotification[entity=SchedulerResourceAdaptor].SchedulerResourceAdaptor] (pool-27-thread-1) Verify configuration in RA Entity SchedulerResourceAdaptor 
2013-07-22 17:41:49,616 INFO [org.mobicents.slee.container.management.ResourceManagement] (pool-27-thread-1) Created Resource Adaptor Entity SchedulerResourceAdaptor for ResourceAdaptorID[name=SchedulerResourceAdaptor,vendor=org.mobicents,version=1.0] Config Properties: [] 
2013-07-22 17:41:49,866 INFO [org.mobicents.slee.container.management.ResourceManagement] (pool-27-thread-1) Activated RA Entity SchedulerResourceAdaptor 
.
.
.
2013-07-22 17:41:51,122 INFO [org.mobicents.slee.container.management.jmx.DeploymentMBeanImpl] (pool-27-thread-1) Installing DeployableUnitID[url=file:/C:/JavaT/jboss/server/default/deploy/smsc-services-du-6.1.2-TelScale-SNAPSHOT.jar/] 
2013-07-22 17:41:52,307 INFO [org.mobicents.slee.container.management.jmx.DeploymentMBeanImpl] (pool-27-thread-1) Installed LibraryID[name=com.telscale.smsc,vendor=smsc-library,version=1.0] 
2013-07-22 17:41:52,349 INFO [org.mobicents.slee.container.management.jmx.DeploymentMBeanImpl] (pool-27-thread-1) Installed SbbID[name=AlertSbb,vendor=org.mobicents,version=1.0] 
2013-07-22 17:41:52,408 INFO [org.mobicents.slee.container.management.jmx.DeploymentMBeanImpl] (pool-27-thread-1) Installed SbbID[name=RxSmppServerSbb,vendor=org.mobicents,version=1.0] 
2013-07-22 17:41:52,618 INFO [org.mobicents.slee.container.management.jmx.DeploymentMBeanImpl] (pool-27-thread-1) Installed SbbID[name=SriSbb,vendor=org.mobicents,version=1.0] 
.
.
.
2013-07-22 17:41:53,290 INFO [org.mobicents.slee.container.management.jmx.DeploymentMBeanImpl] (pool-27-thread-1) Installed DeployableUnitID[url=file:/C:/JavaT/jboss/server/default/deploy/smsc-services-du-6.1.2-TelScale-SNAPSHOT.jar/] 
2013-07-22 17:41:53,543 INFO [org.mobicents.slee.container.management.ServiceManagementImpl] (pool-27-thread-1) Activated ServiceID[name=MoService,vendor=org.mobicents,version=1.0] 
.
.
.
 2013-07-22 17:41:54,974 INFO [me.prettyprint.cassandra.connection.CassandraHostRetryService] (Thread-27) Downed Host Retry service started with queue size -1 and retry delay 10s 
2013-07-22 17:41:55,004 INFO [me.prettyprint.cassandra.service.JmxMonitor] (Thread-27) Registering JMX me.prettyprint.cassandra.service_TelestaxSMSC:ServiceType=hector,MonitorType=hector 
2013-07-22 17:41:55,014 INFO [javax.slee.RAEntityNotification[entity=SchedulerResourceAdaptor].SchedulerResourceAdaptor] (Thread-27) Scheduler IS up, starting fetch tasks 
2013-07-22 17:41:55,019 INFO [org.mobicents.smsc.smpp.SmscManagement] (main) SMSC configuration file path C:\JavaT\jboss\server\default\data\SmscManagement_smsc.xml 
2013-07-22 17:41:55,022 INFO [org.mobicents.smsc.smpp.SmppServerManagement] (main) Loading SMPP Server Properties from C:\JavaT\jboss\server\default\data\SmscManagement_smppserver.xml 
2013-07-22 17:41:55,297 INFO [org.mobicents.smsc.smpp.SmppServerManagement] (main) Starting SMPP server... 
2013-07-22 17:41:55,322 INFO [com.cloudhopper.smpp.impl.DefaultSmppServer] (main) SmscManagement started on SMPP port [2776] 
2013-07-22 17:41:55,322 INFO [org.mobicents.smsc.smpp.SmppServerManagement] (main) SMPP server started 
2013-07-22 17:41:55,378 INFO [org.mobicents.smsc.smpp.SmppClientOpsThread] (Thread-30) SmppClientOpsThread started. 
2013-07-22 17:41:55,379 INFO [org.mobicents.smsc.smpp.SmscManagement] (main) Started SmscManagement 
2013-07-22 17:41:55,379 INFO [javax.slee.RAEntityNotification[entity=SmppServerRA].SmppServerResourceAdaptor] (main) Activated RA Entity SmppServerRA 
2013-07-22 17:42:00,652 INFO [org.apache.coyote.http11.Http11Protocol] (main) Starting Coyote HTTP/1.1 on http-127.0.0.1-8080 
2013-07-22 17:42:00,674 INFO [org.apache.coyote.ajp.AjpProtocol] (main) Starting Coyote AJP/1.3 on ajp-127.0.0.1-8009 
2013-07-22 17:42:00,689 INFO [org.jboss.bootstrap.microcontainer.ServerImpl] (main) JBoss (Microcontainer) [5.1.0.GA (build: SVNTag=JBoss_5_1_0_GA date=200905221634)] Started in 1m:45s:372ms
]]>
				</screen>		
</para>
</step>
<step>
<para>If you are starting &THIS.PLATFORM; &THIS.APPLICATION; for the first time, SS7 and SMSC working parameters (and possibly database access) are not configured. You need to use the Shell Client or the GUI to connect to the Gateway and configure the SS7 Stack and SMSC. Once configured, the state and configuration is persisted which stands server re-start. The next chapter will discuss in detail about configuration.</para> 
</step>

			</procedure>
			<procedure>
				<title>Stop the Gateway</title>
				<step><para>To stop the &THIS.PLATFORM; &THIS.APPLICATION;, you must shut down the JBoss Application Server. To shut down the server(s) you must execute the <command>shutdown.sh -s</command> (Unix) or 
					<command>shutdown.bat -s</command> (Microsoft Windows) script in the <filename>telscale-smscgateway-6.1.1.GA/jboss-5.1.0.GA/bin</filename> 
					directory (on Unix or Windows).</para></step>
				<step><para> If the server stopped properly, you will see the following three lines as the 
					last output in the Unix terminal or Command Prompt:
                        <screen><![CDATA[[Server] Shutdown complete
Halting VM]]></screen></para></step>
			</procedure>		

	</section>
<section id="running_the_gateway_simulator">
		<title>Running the Gateway - Simulator Profile</title>
			<para>The &THIS.PLATFORM; &THIS.APPLICATION; offers you an option to run the Gateway with a "simulator" profile for testing purpose. The "simulator" profile is a pre-configured profile to work with the jss7-simulator and the smpp-simulator. Starting the Gateway with the "simulator" profile is similar to the steps explained for the "default" profile except that you must pass the string value "simulator" to the -c command line option when invoking the run script. 
<screen><![CDATA[
[bin]$ ./run.sh -c simulator
]]>
</screen>
</para>	
		<section id="configuring_the_gateway_simulator_profile">
			<title>Configuring the Gateway in Simulator Profile</title>
			<para>In order to configure the Gateway in a Simulator Profile, you can make use of the following commands:</para>
<screen><![CDATA[

sctp server create serv1 127.0.0.1 8012 TCP 
sctp server start serv1 
sctp association create ass1 SERVER serv1 127.0.0.1 8011 TCP

m3ua as create as1 IPSP mode SE ipspType server rc 101 traffic-mode loadsharing network-appearance 102 
m3ua asp create asp1 ass1 
m3ua as add as1 asp1 
m3ua asp start asp1 
m3ua route add as1 1 2 3

sccp sap create 1 1 2 2 
sccp dest create 1 1 1 1 0 255 255 
sccp address create 1 82 1 8 0 1 4 000 
sccp address create 2 82 2 8 0 1 4 000 
sccp rule create 1 K 82 0 8 0 1 4 * solitary 1 origination-type localOriginated 
sccp rule create 2 K 82 0 8 0 1 4 * solitary 2 origination-type remoteOriginated 
sccp rsp create 1 1 0 0 
sccp rss create 1 1 8 0

smsc set scgt 22220 
smsc set scssn 8 
smsc set hlrssn 8 
smsc set mscssn 8 
smsc set maxmapv 3

smsc esme create test test test 127.0.0.1 -1 TRANSCEIVER SERVER esme-ton 1 esme-npi 1 esme-range 6666 
smsc esme start test
]]>
</screen>
		</section>

		<section id="running_the_simulator_ss7">
			<title>Running the jSS7 Simulator</title>
			<para>If you are not familiar with the TelScale jss7 Simulator, you can find instructions about using the
jss7-simulator in the TelScale jSS7 User Guide. You will also find example test cases explained in detail in the jSS7 User Guide.</para>

		<procedure>
			<title>Running TelScale jSS7 Simulator</title>
			<step><para>
			Change the working directory to the bin folder in the Simulator's installation directory.
<screen><![CDATA[
[vinu@vinu-neha ~]$ cd TelScale-smsc-<version>/tools/TelScale-ss7-simulator/bin
]]>
</screen>
			</para></step>
			<step>
						<para>
							 Ensure that the
							<filename>run.sh</filename>
							start script is executable.
<screen><![CDATA[
bin$ chmod +x run.sh
]]>
</screen>
					
						</para>
			</step>
			<step>
						<para>
							Execute the
							<filename>run.sh</filename>
							Bourne shell script with the command <literal>./run.sh gui</literal> or in the case of Windows <literal>./run.bat gui</literal>. 
<screen><![CDATA[
bin$ ./run.sh gui
]]>
</screen>
This will launch the Simulator GUI Application.
						</para>

			</step>
			<step>
						<para>
							When the GUI shows up, select "main" (default) as host name and press the 'Start' button. The Simulator is already pre-configured to connect to the SMSC Gateway (running in simulator profile). Press 'Run test' and again click on 'Start' in the next screen. The Simulator will connect to SMSC (via m3ua protocol).
						</para>

			</step>
			<step><para>
The Low level part is configured to TCP (not SMSC) protocol and hence you can test SMSC under Windows OS. The SS7 Simulator will play both HLR and MSC roles and respond to <literal>SendRoutingInfo</literal> and <literal>ForwardSM</literal> requests from SMSC gateways. 
			</para></step>
			<step><para>
 You can configure the <literal>SMS_TEST_CLIENT</literal> testing task to play with different modes including return error responses to SMSC and bulk mode without adding information for any event to an application form. You can also play with different data coding schemes and MAP protocol versions.
			</para></step>
		</procedure>
		</section>
		<section id="running_the_simulator_smpp">
			<title>Running the SMPP Simulator</title>

		<procedure>
			<title>Running TelScale jSS7 Simulator</title>
			<step><para>
			Change the working directory to the bin folder for the jSS7 Simulator.
<screen><![CDATA[
[vinu@vinu-neha ~]$ cd TelScale-smsc-<version>/tools/TelScale-ss7-simulator/bin
]]>
</screen>
			</para></step>
			<step>
						<para>
							 Ensure that the
							<filename>run.sh</filename>
							start script is executable.
<screen><![CDATA[
bin$ chmod +x run.sh
]]>
</screen>
					
						</para>
			</step>
			<step>
						<para>
							Execute the
							<filename>run.sh</filename>
							Bourne shell script with the command <literal>./run.sh gui</literal> or in the case of Windows <literal>./run.bat gui</literal>. 
<screen><![CDATA[
bin$ ./run.sh gui
]]>
</screen>
This will launch the Simulator GUI Application.
						</para>

			</step>
			<step>
						<para>
							When the GUI shows up, select "main" (default) as host name and press the 'Start' button. The Simulator is already pre-configured to connect to the SMSC Gateway (running in simulator profile). Press 'Run test' and again click on 'Start' in the next screen. The Simulator will connect to SMSC (via m3ua protocol).
						</para>

			</step>
		</procedure>
		<procedure>
			<title>Running SMPP Simulator</title>
			<step><para>
			Change the working directory to the bin folder for the SMPP Simulator.
<screen><![CDATA[
[vinu@vinu-neha ~]$ cd TelScale-smsc-<version>/tools/TelScale-smpp-simulator/bin
]]>
</screen>
			</para></step>
			<step>
						<para>
							 Ensure that the
							<filename>run.sh</filename>
							start script is executable.
<screen><![CDATA[
bin$ chmod +x run.sh
]]>
</screen>
					
						</para>
			</step>
			<step>
						<para>
							Execute the
							<filename>run.sh</filename>
							Bourne shell script with the command <literal>./run.sh gui</literal> or in the case of Windows <literal>./run.bat gui</literal>. 
<screen><![CDATA[
bin$ ./run.sh gui
]]>
</screen>
This will launch the SMPP Simulator GUI Application.
						</para>

			</step>
			<step>
						<para>
							<!--When the GUI shows up, select "main" (default) as host name and press the 'Start' button. -->The SMPP Simulator is already pre-configured to connect to the SMSC Gateway (running in simulator profile). Press 'Run test' and then click on 'Start Session' to connect to the SMSC Gateway.
						</para>

			</step>
			<step>
						<para>
Using the button 'Configuring data for message submitting', you can configure different sending modes, data coding schemas, origination and destination addresses.
						</para>

			</step>
			<step>
						<para>
When the SMSC Gateway is running in a "simulator" profile it works with SMPP as ESME with the address "6666" (TON=1, NPI=1). So all messages with the destination address "6666" (TON=1, NPI=1) will be routed to SMPP Simulator. All other messages will be routed to SS7 Simulator.
						</para>

			</step>
		</procedure>
		</section>
</section>
<section id="running_shell">
			<title>Running the Shell</title>	
		<para>
			You must start the Shell client and connect to the managed instance prior to executing commands to configure the Gateway. Shell can be started by issuing the following command from
			<filename>telscale-smscgateway-6.1.1.GA/jboss-5.1.0.GA/bin</filename> directory:
		</para>
		<programlisting>[$] ./ss7-cli.sh</programlisting>
		<para>Once console starts, it will print following information and await further commands:</para>
		<screen>
version=2.0.0-SNAPSHOT,name=telscale CLI,prefix=mobicents,vendor=TeleStax
telscale>
		</screen>
	<para>
			Before issuing further commands you must connect to a managed instance. For more details on connecting to an instance and for a list of all supported commands and details on configuring the SS7 stack refer to the TelScale SS7 Stack User Guide. 
		</para>

</section>
<section id="using_GUI">
		<title>Running the Graphical User Interface</title>
<para> Open a Web Browser and navigate to http://localhost:8080/telscale-management/. This will launch the &THIS.PLATFORM; GUI Management Console which is horizontally segregated into multiple tabs, one tab for each product in the &THIS.PLATFORM; Suite. You will notice that only the tabs of products whose binaries are installed already will be shown enabled and active in the GUI. If you have successfully installed the &THIS.PLATFORM; &THIS.APPLICATION; you will find the tabs for JAIN-SLEE, JMX, SS7 and SMSC GW active and enabled. For more details on using the GUI for SS7 or JAIN-SLEE please refer to their respective user guides. This document only provides instructions for using the GUI to configure the SMSC Gateway.
</para>

<para>
Switch to the SMSC GW tab and you will find that the window will look similar to the figure below. The GUI is divided into three sections:
	<itemizedlist>
	<listitem><para>A left panel listing the management and monitoring units (Server Settings, SMPP Server, ESMEs, DB Routing Rules, Metrics). You can click on any of these to select and navigate to the specific management unit.</para></listitem>
	<listitem><para>A main panel displaying the currently selected management unit. <!-- At the top of this panel you will find a bread crumb trail providing links back to each previous page that you navigated through in order to get to the current page.--> The main view is categorized into multiple tabs to manage different aspects of the selected layer.</para></listitem>
	<listitem><para>A bottom panel displaying the log data. You can clear the log anytime by clicking on the trash icon at the top right corner of this panel. You can also minimize or maximize this panel to suit your needs.</para></listitem>
	</itemizedlist>

	<figure>
  		<title>GUI - &THIS.PLATFORM; &THIS.APPLICATION;</title>
  		<mediaobject>
    		<imageobject>
      			<imagedata fileref="images/GUI-SMSC-GW-main.png" format="PNG" align="center"/>
    		</imageobject>
  		</mediaobject>
	</figure>
</para>
		
		
		<section id="connect_gui">
		<title>Connect to a new Instance</title>
		<para>You can connect to a new instance by entering the IP:Port values and the login credentials in the top left corner of the GUI. However please note that this feature is not available in this release but will be fully functional in the next release. 
		</para>

   </section>	
  <section id="gui_security">
		<title>Authentication</title>	
			<para>
				&THIS.PLATFORM; &THIS.APPLICATION; GUI Management Security is based on the JBoss Security Framework. However please note that the feature is not fully functional yet and you will not be able to sign-out or sign-in using the login panel at the top right corner of the GUI. Future releases will offer a full implementation.
			</para>
 </section>

</section>

</chapter>

