<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "${ent.filename}">
%BOOK_ENTITIES;
]>
<chapter id="configuring">
<title>Configuring</title>
	<para>You must fine-tune Memory and Database settings for better performance before using &THIS.PLATFORM; &THIS.APPLICATION; in production. Once you complete setting up the Gateway you must configure the SS7 Stack the SMSC Gateway following the instructions specified in this guide.
	</para>
	<section id="memory_settings">
		<title>Memory Settings</title>
		<para>
		You should fine tune the JVM memory settings based on your needs but we recommend you allocate a minimum of 3 GB for initial and maximum heap size. These settings are specified in the file<filename>telscale-smscgateway-&tl;version&gt;/jboss-5.1.0.GA/bin/run.conf</filename>.
		</para> 
		<variablelist>
				<varlistentry>
					<term>-Xms3072m</term><listitem><para> Initial heap size, set in megabytes</para></listitem>
 				</varlistentry>
 				<varlistentry>
					<term>-Xmx3072m</term><listitem><para>Maximum heap size, set in megabytes</para></listitem>  
 				</varlistentry>
		</variablelist>
	</section>

	<section id="logging">
		<title>Configuring log4j Logging Service</title>
		<para>
		&THIS.PLATFORM; &THIS.APPLICATION; uses <literal>Apache log4j</literal> for logging. If you are not familiar with the <literal>log4j</literal> package, you can read more about it at the Jakarta <ulink url="http://jakarta.apache.org/log4j/">website</ulink>.
		</para>
		<para>Logging is controlled from a central configuration file located at <filename>telscale-smscgateway-&tl;version&gt;/jboss-5.1.0.GA/server/&lt;profile&gt;/conf/jboss-log4j.xml</filename>, one for each JBoss AS configuration profile. This file defines a set of appenders specifying the log files, what categories of messages should go there, the message format and the level of filtering. For more details, please refer to Section 9.6.3, "Logging Service" in the JBoss AS Getting Started Guide available <ulink url="https://community.jboss.org/wiki/JBossAS5InstallationAndGettingStartedGuide">here</ulink>. </para>
		<para> You must make sure <literal>log4j</literal> is fine tuned for optimal performance in production. We recommend that you set logging threshold to <literal>WARN</literal> and let the CDR appender be <literal>DEBUG</literal>.</para>
	</section>
	<section id="sms_home_routing">
		<title>SMS Home Routing</title>
		<para>According to traditional GSM specifications, all outbound messages pass through an SMSC in the sending network. This allows the SMSC to convert the Mobile Originated (MO) messages into Mobile Terminated (MT) messages and deliver them directly to the destination devices, regardless of what network they are on. As a result, inbound messages generated on other networks will be sent directly to the destination devices under the control of the SMSC in the sending network, not the home network. In this traditional setup, operators can add value to the MO messages but not to the MT messages that the customer may receive from other networks, since they do not pass through an SMSC in the home network.
		</para>
		<para>
		SMS Home Routing is a modification to the original GSM specifications, adopted by the 3GPP in 2007, that changed the way inbound messages are treated by the mobile networks. Home Routing uses the recipient network's Home Location Register (HLR) to change the flow of inbound messages, directing them to an MT Services Platform, rather than straight to the destination devices. The MT Services platform can add value to the MT messages and apply advanced services such as anti-spam, protection, divert, archiving, etc. to the messages prior to delivery.
		</para>
		<para>
		Home Routing enables operators to offer a full range of value-added services to both inbound and outbound SMS thereby enhancing customer experience while generating additional revenue for the operators.
		</para>
		<para>
		&THIS.PLATFORM; &THIS.APPLICATION; supports SMS Home Routing that enables you to handle Mobile Terminated messages in the network that owns the customer so you can offer a full range of advanced and value added services on both inbound and outbound SMS. You may switch on/off SMS Home Routing according to your requirements. You can configure this by setting the parameter <literal>smshomerouting</literal> to true/false using the CLI or the GUI. For more details refer to <xref linkend="smshomerouting" />.</para>
	</section>
	<section id="CDR_logging_settings">
		<title>CDR Logging Settings</title>
		<para>
			&THIS.PLATFORM; &THIS.APPLICATION; is configured to generate CDR in a plain text file located at <filename>telscale-smscgateway-&lt;version&gt;/jboss-5.1.0.GA/server/&lt;profile&gt;/log/cdr.log</filename>. 
		</para>
		<para>&THIS.PLATFORM; &THIS.APPLICATION; can be configured to generate CDR for both receipt and regular messages or generate CDR only for regular messages. This is configurable by setting the parameter <literal>generateReceiptCdr</literal> to true/false using the CLI or the GUI. For more details refer to <xref linkend="generateReceiptCdr" />.
		</para>
		<para>
The CDR generated in a text file is of the below format:
<screen><![CDATA[
SUBMIT_DATE,ADDR_SRC_DIGITS,ADDR_SRC_TON,ADDR_SRC_NPI,ADDR_DST_DIGITS,
ADDR_DST_TON,ADDR_DST_NPI,SM_STATUS,ORIG_SYSTEM_ID,MESSAGE_ID,
First 20 chars of SMS,
If failed the reason for failure (empty string if delivery is successfull).
]]></screen>
		</para>
		<para>For more details on these parameters, please refer to their explanation in <xref linkend="SLOT_MESSAGES_TABLE_yyyy_mm_dd" />. If you would like to know more details of the SMS, you must dig the table in the Cassandra database.
		</para>
<para>
The CDR text file contains a special field (<literal>SM_STATUS</literal>) that specifies the message delivery status. This field can have any of the following values: 
	<variablelist>
	<title>If delivering to GSM network:</title>
	<varlistentry>
	<term>partial</term>
	<listitem><para>Delivered a part of a multi-part message but not the last part.
	</para></listitem>
	</varlistentry>
	<varlistentry>
	<term>success</term>
	<listitem><para>Delivered the last part of a multi-part message or a single message.
	</para></listitem>
	</varlistentry>
	<varlistentry>
	<term>temp_failed</term>
	<listitem><para>Failed delivering a part of a multi-part message or a single message. It does not indicate if a resend will be attempted or not.
	</para></listitem>
	</varlistentry>
	<varlistentry>
	<term>failed</term>
	<listitem><para>Failed delivering a message and the SMSC will now attempt to resend the message or part of the message.
	</para></listitem>
	</varlistentry>
	</variablelist>
	<variablelist>
	<title>If delivering to ESME:</title>
	<varlistentry>
	<term>partial_esme</term>
	<listitem><para>Delivered a part of a multi-part message but not the last part.
	</para></listitem>
	</varlistentry>
	<varlistentry>
	<term>success_esme</term>
	<listitem><para>Delivered the last part of a multi-part message or a single message.
	</para></listitem>
	</varlistentry>
	<varlistentry>
	<term>temp_failed_esme</term>
	<listitem><para>Failed delivering a part of a multi-part message or a single message.
	</para></listitem>
	</varlistentry>
	<varlistentry>
	<term>failed_esme</term>
	<listitem><para>Failed delivering a message and the SMSC will now attempt to resend the message or part of the message.
	</para></listitem>
	</varlistentry>
	</variablelist>
</para>

	</section>
</chapter>
