
<h3 style="margin: 0px;">
	<i class="icon-cogs"></i> SMPP Servers
</h3>
<hr style="margin: 10 0px;" />
<span style="float: right;">
	<button id="refresh" style="float: right; margin-right: 20px; margin-left: 20px; height: 30px;" class="btn btn-medium btn-success" data-toggle="tooltip" data-placement="left" title="Refresh SMPPP Servers List" onclick="updateServices();">
		<i class="icon-refresh"></i>
	</button>
</span>
<span id="services-table-wrapper">
	<table id="no-services-table" class="table" style="display: none;">
		<tr>
			<td>
				<div class="alert alert-info fade in">
					<strong>No Services!</strong> There are no services matching the
					filtering criteria.
				</div>
			</td>
		</tr>
	</table>

	<table id="services-table" class="table table-hover">
		<thead>
			<tr>
				<th style="width: 30px;">&nbsp;</th>
				<th>Name</th>
				<th style="text-align: center; width: 150px;">Actions</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
</span>

<script type="text/javascript">
				function updateServices() {
					mbeanSearch="com.telscale.smsc:layer=SmppServerManagement,name=*";
					var mbean;
					$.ajax({
						dataType: "json",
						url: window.jolokiaProtocol+ "//"  + window.jolokiaAddress + ":" + window.jolokiaPort + "/jolokia/search/" + mbeanSearch
					})
					.done(function(html) {
						if (html.error) {
							logToConsole("ERROR", html.error);
						}
						else {		
							
							$('.service-row').remove();
							jQuery.each(html.value, function() {
								mbean = this;
								var j4p = new Jolokia({url: window.jolokiaProtocol + "//" + window.jolokiaAddress + ":" + window.jolokiaPort + "/jolokia/" });
								
								var isSmppServerStarted = j4p.getAttribute(mbean, "Started",{method: "post"});
								var name = j4p.getAttribute(mbean, "Name",{method: "post"});
								var systremId = j4p.getAttribute(mbean, "SystemId",{method: "post"});
								var port = j4p.getAttribute(mbean, "BindPort",{method: "post"});
								var bindTimeout  = j4p.getAttribute(mbean, "BindTimeout",{method: "post"});
								var autoNegotiateInterfaceVersion = j4p.getAttribute(mbean, "AutoNegotiateInterfaceVersion",{method: "post"});
								var interfaceVersion = j4p.getAttribute(mbean, "InterfaceVersion",{method: "post"});
								var maxConnectionSize = j4p.getAttribute(mbean, "MaxConnectionSize",{method: "post"});
								var defaultWindowSize = j4p.getAttribute(mbean, "DefaultWindowSize",{method: "post"});
								var defaultWindowWaitTimeout = j4p.getAttribute(mbean, "DefaultWindowWaitTimeout",{method: "post"});
								var defaultRequestExpiryTimeout = j4p.getAttribute(mbean, "DefaultRequestExpiryTimeout",{method: "post"});
								var defaultWindowMonitorInterval = j4p.getAttribute(mbean, "DefaultWindowMonitorInterval",{method: "post"});
								var defaultSessionCountersEnabled = j4p.getAttribute(mbean, "DefaultSessionCountersEnabled",{method: "post"});
								
								
								serviceClass = isSmppServerStarted ? 'active-service' : 'inactive-service';
								
								$('#services-table').children('tbody').append('<tr class="service-row"><td style="vertical-align: middle; text-align: center;"><i style="color: ' + (isSmppServerStarted ? '#51A351' : '#BD362F') + ';" class="' + (isSmppServerStarted ? 'icon-play-circle' : 'icon-remove-circle') + '"></i></td>'+
										'<td>' + name + '</td>' +
										'<td style="font-size: 16px; vertical-align: middle; text-align: center; width: 150px;">' + 
											'<button class="btn btn-small btn-success"' + (isSmppServerStarted ? 'disabled' : '') + ' data-toggle="tooltip" title="Start SMPP Server" data-placement="bottom" onclick="serviceOperation(\'start\', \'' + name + '\')"><i class="icon-play"> </i></button> ' +
											'<button class="btn btn-small btn-danger"' + (!isSmppServerStarted ? 'disabled' : '') + ' data-toggle="tooltip" title="Stop SMPP Server" data-placement="bottom" onclick="serviceOperation(\'stop\', \'' + name +  '\')"><i class="icon-stop"> </i></button> ' +
											'<a href="#entities-modal'+name+'" role="button" class="btn btn-info btn-small" data-toggle="modal"><i class="icon-external-link"></i></a>' +
										'</td>' );		
								
								$('#services-table-wrapper').append('<div id="entities-modal'+name+'" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">'+
										'<div class="modal-header">'+
											'<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'+
											'<h3>SMPP Server '+name+' properties</h3>'+
										'</div>'+	
										'<div id="entities-modal-body" class="modal-body">'+
												'<div class="accordion-group">' +
													'<div class="accordion-heading">' +name+ 										
													'</div>'+
													'<div id="' + name + '" class="accordion-body">' +
														'<div class="accordion-inner">' +
															'<strong><i class="icon-list"></i> SMPP Server Configuration Properties</strong>' +
															'<table class="table table-condensed table-striped">' + 
																'<thead><tr><th style="width: 40%;">Name</th><th style="width: 55%;">Value</th><th>&nbsp;</th></tr></thead>' +
																'<tbody>'+
																	'<tr>'+
																		'<td style="font-size: 0.9em;">SystemId</td>'+
																		'<td style="font-size: 0.9em; padding: 0;">'+
																			'<span id="' + systremId + '-input" style="display: none;">'+
																				'<input type="text" class="input-small" value="' + systremId + '" /> ' +
																				'<i class="icon-ok" style="cursor: pointer;" onclick="$(\'[id^='+systremId+']\').toggle(); $(\'input[id^='+systremId+']\').focus();"></i> ' +
																				'<i class="icon-remove" style="cursor: pointer;" onclick="$(\'[id^='+systremId+']\').toggle(); $(\'input[id^='+systremId+']\').focus();"></i>' + 
																			'</span>'+
																			'<span id="' + systremId + '-text">' + systremId + '</span>'+
																		'</td>'+
																		'<td><i class="icon-pencil" data-toggle="tooltip" title="Edit" style="cursor: pointer;" onclick="$(\'[id^='+systremId+']\').toggle(); $(\'input[id^='+systremId+']\').focus();"></i>' +
																		'</td>'+
																	'</tr>'+																
																
																	'<tr>'+
																		'<td style="font-size: 0.9em;">Port</td>'+
																		'<td style="font-size: 0.9em; padding: 0;">'+
																			'<span id="' + port + '-input" style="display: none;">'+
																				'<input type="text" class="input-small" value="' + port + '" /> ' +
																				'<i class="icon-ok" style="cursor: pointer;" onclick="$(\'[id^='+port+']\').toggle(); $(\'input[id^='+port+']\').focus();"></i> ' +
																				'<i class="icon-remove" style="cursor: pointer;" onclick="$(\'[id^='+port+']\').toggle(); $(\'input[id^='+port+']\').focus();"></i>' + 
																			'</span>'+
																			'<span id="' + port + '-text">' + port + '</span>'+
																		'</td>'+
																		'<td><i class="icon-pencil" data-toggle="tooltip" title="Edit" style="cursor: pointer;" onclick="$(\'[id^='+port+']\').toggle(); $(\'input[id^='+port+']\').focus();"></i>' +
																		'</td>'+
																	'</tr>'+
																	
																	'<tr>'+
																		'<td style="font-size: 0.9em;">BindTimeout</td>'+
																		'<td style="font-size: 0.9em; padding: 0;">'+
																			'<span id="' + bindTimeout + '-input" style="display: none;">'+
																				'<input type="text" class="input-small" value="' + bindTimeout + '" /> ' +
																				'<i class="icon-ok" style="cursor: pointer;" onclick="$(\'[id^='+bindTimeout+']\').toggle(); $(\'input[id^='+bindTimeout+']\').focus();"></i> ' +
																				'<i class="icon-remove" style="cursor: pointer;" onclick="$(\'[id^='+bindTimeout+']\').toggle(); $(\'input[id^='+bindTimeout+']\').focus();"></i>' + 
																			'</span>'+
																			'<span id="' + bindTimeout + '-text">' + bindTimeout + '</span>'+
																		'</td>'+
																		'<td><i class="icon-pencil" data-toggle="tooltip" title="Edit" style="cursor: pointer;" onclick="$(\'[id^='+bindTimeout+']\').toggle(); $(\'input[id^='+bindTimeout+']\').focus();"></i>' +
																		'</td>'+
																	'</tr>'+
																	
																	'<tr>'+
																		'<td style="font-size: 0.9em;">AutoNegotiateInterfaceVersion</td>'+
																		'<td style="font-size: 0.9em; padding: 0;">'+
																			'<span id="' + autoNegotiateInterfaceVersion + '-input" style="display: none;">'+
																				'<input type="text" class="input-small" value="' + autoNegotiateInterfaceVersion + '" /> ' +
																				'<i class="icon-ok" style="cursor: pointer;" onclick="$(\'[id^='+autoNegotiateInterfaceVersion+']\').toggle(); $(\'input[id^='+autoNegotiateInterfaceVersion+']\').focus();"></i> ' +
																				'<i class="icon-remove" style="cursor: pointer;" onclick="$(\'[id^='+autoNegotiateInterfaceVersion+']\').toggle(); $(\'input[id^='+autoNegotiateInterfaceVersion+']\').focus();"></i>' + 
																			'</span>'+
																			'<span id="' + autoNegotiateInterfaceVersion + '-text">' + autoNegotiateInterfaceVersion + '</span>'+
																		'</td>'+
																		'<td><i class="icon-pencil" data-toggle="tooltip" title="Edit" style="cursor: pointer;" onclick="$(\'[id^='+autoNegotiateInterfaceVersion+']\').toggle(); $(\'input[id^='+autoNegotiateInterfaceVersion+']\').focus();"></i>' +
																		'</td>'+
																	'</tr>'+
																	
																	'<tr>'+
																		'<td style="font-size: 0.9em;">InterfaceVersion</td>'+
																		'<td style="font-size: 0.9em; padding: 0;">'+
																			'<span id="' + interfaceVersion + '-input" style="display: none;">'+
																				'<input type="text" class="input-small" value="' + interfaceVersion + '" /> ' +
																				'<i class="icon-ok" style="cursor: pointer;" onclick="$(\'[id^='+interfaceVersion+']\').toggle(); $(\'input[id^='+interfaceVersion+']\').focus();"></i> ' +
																				'<i class="icon-remove" style="cursor: pointer;" onclick="$(\'[id^='+interfaceVersion+']\').toggle(); $(\'input[id^='+interfaceVersion+']\').focus();"></i>' + 
																			'</span>'+
																			'<span id="' + interfaceVersion + '-text">' + interfaceVersion + '</span>'+
																		'</td>'+
																		'<td><i class="icon-pencil" data-toggle="tooltip" title="Edit" style="cursor: pointer;" onclick="$(\'[id^='+interfaceVersion+']\').toggle(); $(\'input[id^='+interfaceVersion+']\').focus();"></i>' +
																		'</td>'+
																	'</tr>'+
																	
																	'<tr>'+
																		'<td style="font-size: 0.9em;">MaxConnectionSize</td>'+
																		'<td style="font-size: 0.9em; padding: 0;">'+
																			'<span id="' + maxConnectionSize + '-input" style="display: none;">'+
																				'<input type="text" class="input-small" value="' + maxConnectionSize + '" /> ' +
																				'<i class="icon-ok" style="cursor: pointer;" onclick="$(\'[id^='+maxConnectionSize+']\').toggle(); $(\'input[id^='+maxConnectionSize+']\').focus();"></i> ' +
																				'<i class="icon-remove" style="cursor: pointer;" onclick="$(\'[id^='+maxConnectionSize+']\').toggle(); $(\'input[id^='+maxConnectionSize+']\').focus();"></i>' + 
																			'</span>'+
																			'<span id="' + maxConnectionSize + '-text">' + maxConnectionSize + '</span>'+
																		'</td>'+
																		'<td><i class="icon-pencil" data-toggle="tooltip" title="Edit" style="cursor: pointer;" onclick="$(\'[id^='+maxConnectionSize+']\').toggle(); $(\'input[id^='+maxConnectionSize+']\').focus();"></i>' +
																		'</td>'+
																	'</tr>'+
																	
																	'<tr>'+
																		'<td style="font-size: 0.9em;">DefaultWindowSize</td>'+
																		'<td style="font-size: 0.9em; padding: 0;">'+
																			'<span id="' + defaultWindowSize + '-input" style="display: none;">'+
																				'<input type="text" class="input-small" value="' + defaultWindowSize + '" /> ' +
																				'<i class="icon-ok" style="cursor: pointer;" onclick="$(\'[id^='+defaultWindowSize+']\').toggle(); $(\'input[id^='+defaultWindowSize+']\').focus();"></i> ' +
																				'<i class="icon-remove" style="cursor: pointer;" onclick="$(\'[id^='+defaultWindowSize+']\').toggle(); $(\'input[id^='+defaultWindowSize+']\').focus();"></i>' + 
																			'</span>'+
																			'<span id="' + defaultWindowSize + '-text">' + defaultWindowSize + '</span>'+
																		'</td>'+
																		'<td><i class="icon-pencil" data-toggle="tooltip" title="Edit" style="cursor: pointer;" onclick="$(\'[id^='+defaultWindowSize+']\').toggle(); $(\'input[id^='+defaultWindowSize+']\').focus();"></i>' +
																		'</td>'+
																	'</tr>'+
																	
																	'<tr>'+
																		'<td style="font-size: 0.9em;">DefaultWindowWaitTimeout</td>'+
																		'<td style="font-size: 0.9em; padding: 0;">'+
																			'<span id="' + defaultWindowWaitTimeout + '-input" style="display: none;">'+
																				'<input type="text" class="input-small" value="' + defaultWindowWaitTimeout + '" /> ' +
																				'<i class="icon-ok" style="cursor: pointer;" onclick="$(\'[id^='+defaultWindowWaitTimeout+']\').toggle(); $(\'input[id^='+defaultWindowWaitTimeout+']\').focus();"></i> ' +
																				'<i class="icon-remove" style="cursor: pointer;" onclick="$(\'[id^='+defaultWindowWaitTimeout+']\').toggle(); $(\'input[id^='+defaultWindowWaitTimeout+']\').focus();"></i>' + 
																			'</span>'+
																			'<span id="' + defaultWindowWaitTimeout + '-text">' + defaultWindowWaitTimeout + '</span>'+
																		'</td>'+
																		'<td><i class="icon-pencil" data-toggle="tooltip" title="Edit" style="cursor: pointer;" onclick="$(\'[id^='+defaultWindowWaitTimeout+']\').toggle(); $(\'input[id^='+defaultWindowWaitTimeout+']\').focus();"></i>' +
																		'</td>'+
																	'</tr>'+
																	
																	'<tr>'+
																		'<td style="font-size: 0.9em;">DefaultRequestExpiryTimeout</td>'+
																		'<td style="font-size: 0.9em; padding: 0;">'+
																			'<span id="' + defaultRequestExpiryTimeout + '-input" style="display: none;">'+
																				'<input type="text" class="input-small" value="' + defaultRequestExpiryTimeout + '" /> ' +
																				'<i class="icon-ok" style="cursor: pointer;" onclick="$(\'[id^='+defaultRequestExpiryTimeout+']\').toggle(); $(\'input[id^='+defaultRequestExpiryTimeout+']\').focus();"></i> ' +
																				'<i class="icon-remove" style="cursor: pointer;" onclick="$(\'[id^='+defaultRequestExpiryTimeout+']\').toggle(); $(\'input[id^='+defaultRequestExpiryTimeout+']\').focus();"></i>' + 
																			'</span>'+
																			'<span id="' + defaultRequestExpiryTimeout + '-text">' + defaultRequestExpiryTimeout + '</span>'+
																		'</td>'+
																		'<td><i class="icon-pencil" data-toggle="tooltip" title="Edit" style="cursor: pointer;" onclick="$(\'[id^='+defaultRequestExpiryTimeout+']\').toggle(); $(\'input[id^='+defaultRequestExpiryTimeout+']\').focus();"></i>' +
																		'</td>'+
																	'</tr>'+
																	
																	'<tr>'+
																		'<td style="font-size: 0.9em;">DefaultWindowMonitorInterval</td>'+
																		'<td style="font-size: 0.9em; padding: 0;">'+
																			'<span id="' + defaultWindowMonitorInterval + '-input" style="display: none;">'+
																				'<input type="text" class="input-small" value="' + defaultWindowMonitorInterval + '" /> ' +
																				'<i class="icon-ok" style="cursor: pointer;" onclick="$(\'[id^='+defaultWindowMonitorInterval+']\').toggle(); $(\'input[id^='+defaultWindowMonitorInterval+']\').focus();"></i> ' +
																				'<i class="icon-remove" style="cursor: pointer;" onclick="$(\'[id^='+defaultWindowMonitorInterval+']\').toggle(); $(\'input[id^='+defaultWindowMonitorInterval+']\').focus();"></i>' + 
																			'</span>'+
																			'<span id="' + defaultWindowMonitorInterval + '-text">' + defaultWindowMonitorInterval + '</span>'+
																		'</td>'+
																		'<td><i class="icon-pencil" data-toggle="tooltip" title="Edit" style="cursor: pointer;" onclick="$(\'[id^='+defaultWindowMonitorInterval+']\').toggle(); $(\'input[id^='+defaultWindowMonitorInterval+']\').focus();"></i>' +
																		'</td>'+
																	'</tr>'+
																	
																	'<tr>'+
																		'<td style="font-size: 0.9em;">DefaultSessionCountersEnabled</td>'+
																		'<td style="font-size: 0.9em; padding: 0;">'+
																			'<span id="' + defaultSessionCountersEnabled + '-input" style="display: none;">'+
																				'<input type="text" class="input-small" value="' + defaultSessionCountersEnabled + '" /> ' +
																				'<i class="icon-ok" style="cursor: pointer;" onclick="$(\'[id^='+defaultSessionCountersEnabled+']\').toggle(); $(\'input[id^='+defaultSessionCountersEnabled+']\').focus();"></i> ' +
																				'<i class="icon-remove" style="cursor: pointer;" onclick="$(\'[id^='+defaultSessionCountersEnabled+']\').toggle(); $(\'input[id^='+defaultSessionCountersEnabled+']\').focus();"></i>' + 
																			'</span>'+
																			'<span id="' + defaultSessionCountersEnabled + '-text">' + defaultSessionCountersEnabled + '</span>'+
																		'</td>'+
																		'<td><i class="icon-pencil" data-toggle="tooltip" title="Edit" style="cursor: pointer;" onclick="$(\'[id^='+defaultSessionCountersEnabled+']\').toggle(); $(\'input[id^='+defaultSessionCountersEnabled+']\').focus();"></i>' +
																		'</td>'+
																	'</tr>'+
																	
																'</tbody>' +
															'</table>' +															
														'</div>'+
													'</div>'+
												'</div>'+
										'</div>'+
										'<div class="modal-footer">'+
											'<a href="#" onclick="$(\'#entities-modal'+name+'\').modal(\'hide\'); return false;" class="btn">Close</a>'+
										'</div>'+										
									'</div>');
							});
						}
					})
					.fail(function() {
						logToConsole("ERROR", "Failure trying to communicate with the SMSC Gateway. Please try again later.");
					})					
				
				}
				function serviceOperation(operation, name) {
					mbeanSearch="com.telscale.smsc:layer=SmppServerManagement,name="+name;
					
					alert(operation+' : '+mbeanSearch);
					
					jolokia.execute(mbeanSearch,operation,
							{
								success: function(value) {
									updateServices();
									logToConsole('INFO', 'Successfully '+operation+'ed SmppServerManagement ' + name );
								}
							});	
					
				}				
				$(document).ready(function () {
					updateServices();
				});
			</script>
