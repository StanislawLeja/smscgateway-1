
<h3 style="margin: 0px;">
	<i class="icon-cogs"></i> External Short Messaging Entities
</h3>
<hr style="margin: 10 0px;" />
<span style="float: right;">
	<button id="refresh" style="float: right; margin-right: 20px; margin-left: 20px; height: 30px;" class="btn btn-medium btn-success" data-toggle="tooltip" data-placement="left" title="Refresh ESME List" onclick="updateEsmes();">
		<i class="icon-refresh"></i>
	</button>
</span>
<span id="esmes-table-wrapper">
	<table id="no-esmes-table" class="table" style="display: none;">
		<tr>
			<td>
				<div class="alert alert-info fade in">
					<strong>No ESME!</strong> 
				</div>
			</td>
		</tr>
	</table>

	<table id="esmes-table" class="table table-hover">
		<thead>
			<tr>
				<th style="width: 30px;">&nbsp;</th>
				<th>Name</th>
				<th>SystemId</th>
				<th>Type</th>
				<th>State</th>
				<th style="text-align: center; width: 150px;">Actions</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
	<p>
		<a href="#entities-modal" role="button" class="btn btn-info btn-small" data-toggle="modal" ><i class="icon-external-link"></i> Create ESME</a>
	</p>	
</span>

<div id="entities-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		<h3>Create ESME</h3>
	</div>
	<div id="entities-modal-body" class="modal-body">
		<div class="alert alert-error" id="login-settings-error" style="display:none;">
		  <button type="button" class="close">&times;</button>
		  Some Fields are not correctly filled out, please double check the settings below !
		</div>
		<p>
			<span>
				<label>ESME Name : </label>
				<input id="esmeName" style="" type="text" placeholder="ESME Name" />
				<br/>
				<label>System Id : </label>
				<input id="systemId" style="" type="text" placeholder="System Id" />
				<br/>	
				<label>Password : </label>
				<input id="password" style="" type="text" placeholder="Password" />
				<br/>								
				<label>IP Address: </label>
				<input id="ipAddress" style="" type="text" placeholder="IP Address" />
				<br/>
				<label>IP Port: </label>
				<input id="ipPort" style="" type="text" placeholder="IP Port" />
				<br/>
				<label id="smppBindTypeLabel">Smpp Bind Type: </label>
				<div id="smppBindTypeBtnGrp" class="btn-group" data-toggle="buttons-radio" >
				    <button type="button" class="btn btn-mini" data-name="SmppBindType,TRANSCEIVER">
				        TRANSCEIVER
				    </button>
				    <button type="button" class="btn btn-mini" data-name="SmppBindType,TRANSMITTER">
				        TRANSMITTER
				    </button>
				    <button type="button" class="btn btn-mini" data-name="SmppBindType,RECEIVER">
				        RECEIVER
				    </button>
				</div>
				<br/>	
				<label id="smppSessionTypeLabel">Smpp Session Type: </label>
				<div id="smppSessionTypeBtnGrp" class="btn-group" data-toggle="buttons-radio" >
				    <button type="button" class="btn btn-mini" data-name="SmppSessionType,CLIENT">
				        CLIENT
				    </button>
				    <button type="button" class="btn btn-mini" data-name="SmppSessionType,SERVER">
				        SERVER
				    </button>
				</div>
				<br/>
				<label id="systemTypeLabel">System Type: </label>
				<input id="systemType" style="" type="text" placeholder="System Type" />
				<br/>				
				<label id="versionLabel">Version: </label>
				<div id="versionBtnGrp" class="btn-group" data-toggle="buttons-radio" >
				    <button type="button" class="btn btn-mini" data-name="SmppVersion,3.3">
				        3.3
				    </button>
				    <button type="button" class="btn btn-mini" data-name="SmppVersion,3.4">
				        3.4
				    </button>
				    <button type="button" class="btn btn-mini" data-name="SmppVersion,5.0">
				        5.0
				    </button>				    
				</div>
				<br/>
				<label>ESME Type of number (TON): </label>
				<input id="esmeTon" style="" type="text" placeholder="ESME Type of number" value="0"/>
				<br/>
				<label>ESME Number plan indicator (NPI): </label>
				<input id="esmeNpi" style="" type="text" placeholder="ESME Number plan indicator" value="0"/>
				<br/>
				<label>ESME Range: </label>
				<input id="esmeRange" style="" type="text" placeholder="ESME Range" value="^[0-9a-zA-Z]*"/>
				<br/>
				<label>Cluster Name: </label>
				<input id="clusterName" style="" type="text" placeholder="Cluster Name" />
				<br/>						
				<label>Windows Size: </label>
				<input id="windowSize" style="" type="text" placeholder="Window Size" value="1"/>
				<br/>						
				<label>Connect Timeout: </label>
				<input id="connectTimeout" style="" type="text" placeholder="Connect Timeout" value="10000"/>
				<br/>
				<label>Request Expiry Timeout: </label>
				<input id="reqExpTimeout" style="" type="text" placeholder="Request Expiry Timeout" value="-1"/>
				<br/>				
				<label>Windows Monitor Interval: </label>
				<input id="windowMonitorInterval" style="" type="text" placeholder="Window Monitor Interval" value="-1"/>
				<br/>
				<label>Windows Wait Timeout: </label>
				<input id="windowWaitTimeout" style="" type="text" placeholder="Window Wait Timeout" value="60000"/>
				<br/>
				<label>Counters Enabled: </label>
				<div id="countersEnabledBtnGrp" class="btn-group" data-toggle="buttons-radio" >
				    <button type="button" class="btn btn-mini" data-name="CountersEnabled,True">
				        Yes
				    </button>
				    <button type="button" class="btn btn-mini" data-name="CountersEnabled,False">
				        No
				    </button>
				</div>
				<div id="realform"></div>
				<br/>
				<label>Enquire Link Delay: </label>
				<input id="enqLinkDelay" style="" type="text" placeholder="Enquire Link Delay" value="30000"/>
				<br/>
																																																																				
				<button id="add-entity-button" class="btn btn btn-primary" onclick="createEsme()">Create</button>
			</span>
		</p>
		<p>&nbsp;</p>
		<div class="accordion" id="entities-accordion">
		</div>
	</div>
	<div class="modal-footer">
		<a href="#" onclick="$('#entities-modal').modal('hide'); return false;" class="btn">Close</a>
	</div>
</div>

<script type="text/javascript">
$(function () {
    $('div.btn-group button[data-name]').on('click', function() {
        var select = $(this).data('name').split(',');
        var elem = $('#realform > input[name="'+select[0]+'"]');
        if(elem.length != 0)
            elem.remove();
        if(elem.attr('value') != select[1])
            $('<input type="hidden" id="'+select[0]+'" name="'+select[0]+'" value="'+select[1]+'" />').appendTo('#realform');
    });
});
	function updateEsmes() {
		mbeanSearch="com.telscale.smsc:layer=Esme,name=*";
		var mbeanVar;
		$.ajax({
			dataType: "json",
			url: window.jolokiaProtocol + "//" + window.jolokiaAddress + ":" + window.jolokiaPort + "/jolokia/search/" + mbeanSearch
		})
		.done(function(html) {
			if (html.error) {
				logToConsole("ERROR", html.error);
			}
			else {		
				
				$('.service-row').remove();
				$('.text-info').remove();
				jQuery.each(html.value, function() {
					mbeanVar = this;
					
					
					jolokia.request(
							[
								{ type: "read", mbean: mbeanVar },
							],
							{ success: [
								function(response) {
									
									var isSmppServerStarted = response.value.Started;
									
									var name = response.value.Name;
									var clusterName = response.value.ClusterName;
									
									var esmeAddress = response.value.Address;
									
									
									var systemId = response.value.SystemId;
									var localType = response.value.LocalTypeName;
									var state = response.value.StateName;
									
									var systemType = response.value.SystemType;
									var bindType = response.value.BindTypeName;
									var interfaceVersion = response.value.InterfaceVersionName;
									var password = response.value.Password;
									
									var windowSize = response.value.WindowSize;
									var requestExpiryTimeout = response.value.RequestExpiryTimeout;
									var windowMonitorInterval = response.value.WindowMonitorInterval;
									var windowWaitTimeout = response.value.WindowWaitTimeout;
									var maxWindowSize = response.value.MaxWindowSize;
									var windowMonitorEnabled = response.value.WindowMonitorEnabled;
									
									var boundDuration = response.value.BoundDuration;
									var rxDataSMCounter = response.value.RxDataSMCounter;
									var rxDeliverSMCounter = response.value.RxDeliverSMCounter;
									var rxEnquireLinkCounter = response.value.RxEnquireLinkCounter;
									var rxSubmitSMCounter = response.value.RxSubmitSMCounter;
									var txDataSMCounter = response.value.TxDataSMCounter;
									var txDeliverSMCounter = response.value.TxDeliverSMCounter;
									var txEnquireLinkCounter = response.value.TxEnquireLinkCounter;
									var txSubmitSMCounter = response.value.TxSubmitSMCounter;
									
									var localAddressAndPort = response.value.LocalAddressAndPort;
									var remoteAddressAndPort = response.value.RemoteAddressAndPort;
									var remoteTypeName = response.value.RemoteTypeName;
									
									var bound = response.value.Bound;
									var closed = response.value.Closed;
									var binding = response.value.Binding;
									var unbinding = response.value.Unbinding;	
									
									
									if(systemType == null || systemType==""){
										systemType = "null";
									}
									
									serviceClass = isSmppServerStarted ? 'active-service' : 'inactive-service';
									
									$('#esmes-table').children('tbody').append('<tr class="service-row"><td style="vertical-align: middle; text-align: center;"><i style="color: ' + (isSmppServerStarted ? '#51A351' : '#BD362F') + ';" class="' + (isSmppServerStarted ? 'icon-play-circle' : 'icon-remove-circle') + '"></i></td>'+
											'<td style="cursor: pointer;" onclick="$(this).parent().next().toggle();">' + name + '</td>' +
											'<td style="cursor: pointer;" onclick="$(this).parent().next().toggle();">' + systemId + '</td>' +
											'<td style="cursor: pointer;" onclick="$(this).parent().next().toggle();">' + localType + '</td>' +
											'<td style="cursor: pointer;" onclick="$(this).parent().next().toggle();">' + state + '</td>' +
											'<td style="font-size: 16px; vertical-align: middle; text-align: center; width: 150px;">' + 
												'<button class="btn btn-small btn-success"' + (isSmppServerStarted ? 'disabled' : '') + ' data-toggle="tooltip" title="Start ESME" data-placement="bottom" onclick="esmeOperation(\'startEsme\', \'' + name + '\')"><i class="icon-play"> </i></button> ' +
												'<button class="btn btn-small btn-danger"' + (!isSmppServerStarted ? 'disabled' : '') + ' data-toggle="tooltip" title="Stop ESME" data-placement="bottom" onclick="esmeOperation(\'stopEsme\', \'' + name +  '\')"><i class="icon-stop"> </i></button> ' +
												'<button class="btn btn-small btn-danger"' + (isSmppServerStarted ? 'disabled' : '') + ' data-toggle="tooltip" title="Remove ESME" data-placement="bottom" onclick="esmeOperation(\'destroyEsme\', \'' + name +  '\')"><i class="icon-remove"> </i></button> ' +
											'</td></tr>'+


											'<tr class="text-info" style="display: none;"><td colspan=6>' +
											'<div class="bs-docs-example bs-docs-example-submenus"> '+
									        '    <div>'+
									        '      <p class="muted">SMPP Properties</p>'+
													'<dl class="dl-horizontal" style="font-size: 0.8em;">' +
														'<dt>ClusterName</dt> <dd>' + clusterName + ' </dd>' + 
														'<dt>SystemType</dt> <dd>' + systemType + ' </dd>' + 
														'<dt>BindType</dt> <dd>' + bindType + ' </dd>' + 
														'<dt>InterfaceVersion</dt> <dd>' + interfaceVersion + ' </dd>' + 
														'<dt>Password</dt> <dd>' + password + ' </dd>' + 
													'</dl>'+
									        '    </div>'+
								        		'<hr style="margin: 5px 0;"/>' +
										        '    <div>'+
										        '      <p class="muted">ESME Address</p>'+
														'<dl class="dl-horizontal" style="font-size: 0.8em;">' +
															'<dt>TypeOfNumber</dt> <dd>' + esmeAddress.ton + ' </dd>' +
															'<dt>NumberPlanIndicator</dt> <dd>' + esmeAddress.npi + ' </dd>' +
															'<dt>AddressRange</dt> <dd>' + esmeAddress.address + ' </dd>' +
														'</dl>'+
										        '    </div>'+				        		
									        	'<hr style="margin: 5px 0;"/>' +
									        '    <div>'+
									        '      <p class="muted">Configuration</p>'+
													'<dl class="dl-horizontal" style="font-size: 0.8em;">' +
														'<dt>WindowSize</dt> <dd>' + windowSize + ' </dd>' +
														'<dt>RequestExpiryTimeout</dt> <dd>' + requestExpiryTimeout + ' </dd>' +
														'<dt>WindowMonitorInterval</dt> <dd>' + windowMonitorInterval + ' </dd>' +
														'<dt>WindowWaitTimeout</dt> <dd>' + windowWaitTimeout + ' </dd>' +
														'<dt>MaxWindowSize</dt> <dd>' + maxWindowSize + ' </dd>' +
														'<dt>WindowMonitorEnabled</dt> <dd>' + windowMonitorEnabled + ' </dd>' +
													'</dl>'+
									        '    </div>'+	
									        '<hr style="margin: 5px 0;"/>' +
									        '    <div>'+
									        '      <p class="muted">Statistics</p>'+
													'<dl class="dl-horizontal" style="font-size: 0.8em;">' +
													'<dt>BoundDuration</dt> <dd>' + boundDuration + ' </dd>' +
													'<dt>RxDataSMCounter</dt> <dd>' + rxDataSMCounter + ' </dd>' +
													'<dt>RxDeliverSMCounter</dt> <dd>' + rxDeliverSMCounter + ' </dd>' +
													'<dt>RxEnquireLinkCounter</dt> <dd>' + rxEnquireLinkCounter + ' </dd>' +
													'<dt>RxSubmitSMCounter</dt> <dd>' + rxSubmitSMCounter + ' </dd>' +
													'<dt>TxDataSMCounter</dt> <dd>' + txDataSMCounter + ' </dd>' +
													'<dt>TxDeliverSMCounter</dt> <dd>' + txDeliverSMCounter + ' </dd>' +
													'<dt>TxEnquireLinkCounter</dt> <dd>' + txEnquireLinkCounter + ' </dd>' +
													'<dt>TxSubmitSMCounter</dt> <dd>' + txSubmitSMCounter + ' </dd>' +
													'</dl>'+
									        '    </div>'+
									        '<hr style="margin: 5px 0;"/>' +
									        '    <div>'+
									        '      <p class="muted">Various</p>'+
													'<dl class="dl-horizontal" style="font-size: 0.8em;">' +
													'<dt>LocalAddressAndPort</dt> <dd>' + localAddressAndPort + ' </dd>' +
													'<dt>RemoteAddressAndPort</dt> <dd>' + remoteAddressAndPort + ' </dd>' +
													'<dt>RemoteTypeName</dt> <dd>' + remoteTypeName + ' </dd>' +
													'</dl>'+
									        '    </div>'+	
									        '<hr style="margin: 5px 0;"/>' +
									        '    <div>'+
									        '      <p class="muted">State</p>'+
													'<dl class="dl-horizontal" style="font-size: 0.8em;">' +
													'<dt>Bound</dt> <dd>' + bound + ' </dd>' +
													'<dt>Closed</dt> <dd>' + closed + ' </dd>' +
													'<dt>Binding</dt> <dd>' + binding + ' </dd>' +
													'<dt>Unbinding</dt> <dd>' + unbinding + ' </dd>' +
													'</dl>'+
									        '    </div>'+	
									        '<hr style="margin: 5px 0;"/>' +
									        '<div class="btn-group">'+
									        '              <button type="button" class="btn" onclick="disableLogBytes(\'' + name +  '\')"><i class="icon-ban-circle"></i> DisableLogBytes</button>'+
									        '              <button type="button" class="btn" onclick="disableLogPdu(\'' + name +  '\')"><i class="icon-ban-circle"></i> DisableLogPdu</button>'+
									        '              <button type="button" class="btn" onclick="dumpWindow(\'' + name +  '\')"><i class="icon-comment-alt"></i> DumpWindow</button>'+
									        '              <button type="button" class="btn" onclick="enableLogBytes(\'' + name +  '\')"><i class="icon-check"></i> EnableLogBytes</button>'+
									        '              <button type="button" class="btn" onclick="enableLogPdu(\'' + name +  '\')"><i class="icon-check"></i> EnableLogPdu</button>'+
									        '              <button type="button" class="btn" onclick="resetCounters(\'' + name +  '\')"><i class="icon-spinner"></i> ResetCounters</button>'+
									        '            </div>'+
									 		'</div>'+
									 		
											'</td></tr>'
									);									
									
								}],
								error: function(value){
									errorUID = ("st" + new Date().getTime()).hashCode();
									createStackTrace(errorUID, value.stacktrace);
									logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
								}
							}
						); 

				});
			}
		})
		.fail(function() {
			logToConsole("ERROR", "Failure trying to communicate with the SMSC Gateway. Please try again later.");
		})
	}
	function disableLogBytes(esmeName){
		mbeanSearch="com.telscale.smsc:layer=Esme,name="+esmeName;
		jolokia.execute(mbeanSearch,"disableLogBytes",
				{
					success: function(value) {
						logToConsole('INFO', 'Successfully disabled log bytes for Esme ' + esmeName );
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}
				});	
	}
	function disableLogPdu(esmeName){
		mbeanSearch="com.telscale.smsc:layer=Esme,name="+esmeName;
		jolokia.execute(mbeanSearch,"disableLogPdu",
				{
					success: function(value) {
						logToConsole('INFO', 'Successfully disabled log pdu for Esme ' + esmeName );
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}
				});	
	}	
	function dumpWindow(esmeName){
		mbeanSearch="com.telscale.smsc:layer=Esme,name="+esmeName;
		jolokia.execute(mbeanSearch,"dumpWindow",
				{
					success: function(value) {
						logToConsole('INFO', 'Successfully dumped window for Esme ' + esmeName );
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}
				});	
	}
	function enableLogBytes(esmeName){
		mbeanSearch="com.telscale.smsc:layer=Esme,name="+esmeName;
		jolokia.execute(mbeanSearch,"enableLogBytes",
				{
					success: function(value) {
						logToConsole('INFO', 'Successfully enabled log bytes for Esme ' + esmeName );
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}
				});	
	}	
	function enableLogPdu(esmeName){
		mbeanSearch="com.telscale.smsc:layer=Esme,name="+esmeName;
		jolokia.execute(mbeanSearch,"enableLogPdu",
				{
					success: function(value) {
						logToConsole('INFO', 'Successfully enabled log pdu for Esme ' + esmeName );
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}
				});	
	}	
	function resetCounters(esmeName){
		mbeanSearch="com.telscale.smsc:layer=Esme,name="+esmeName;
		jolokia.execute(mbeanSearch,"resetCounters",
				{
					success: function(value) {
						logToConsole('INFO', 'Successfully resetted counters for Esme ' + esmeName );
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}
				});	
	}	
	function esmeOperation(operation, name) {
		mbeanSearch="com.telscale.smsc:layer=EsmeManagement,name=SmscManagement";
		jolokia.execute(mbeanSearch,operation,name,
				{
					success: function(value) {
						updateEsmes();
						logToConsole('INFO', 'Successfully '+operation+'ed Esme ' + name );
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}
				});	
		
	}
	function createEsme(){
		var formInvalid = false;
		var focusNotSet = true;
		
		var esmeName = $("#esmeName").val();
		if(esmeName.trim() == "") {
			$("#esmeName").addClass("required");
			if(focusNotSet){
				$("#esmeName").focus();
				focusNotSet = false;
			}
			formInvalid = true;
		} else if($("#esmeName").hasClass("required")) {
			$("#esmeName").removeClass("required");		
		}
		
		var systemId = $("#systemId").val();
		if(systemId.trim() == "") {
			$("#systemId").addClass("required");
			if(focusNotSet){
				$("#systemId").focus();
				focusNotSet = false;
			}
			formInvalid = true;
		} else if($("#systemId").hasClass("required")) {
			$("#systemId").removeClass("required");		
		}
		
		var password = $("#password").val();
		if(password.trim() == "") {
			$("#password").addClass("required");		
			if(focusNotSet){
				$("#password").focus();
				focusNotSet = false;
			}
			formInvalid = true;
		} else if($("#password").hasClass("required")) {
			$("#password").removeClass("required");		
		}
		
		var ipAddress = $("#ipAddress").val();
		if(ipAddress.trim() == "") {
			$("#ipAddress").addClass("required");		
			if(focusNotSet){
				$("#ipAddress").focus();
				focusNotSet = false;
			}
			formInvalid = true;
		} else if($("#ipAddress").hasClass("required")) {
			$("#ipAddress").removeClass("required");		
		}
		
		var ipPort = $("#ipPort").val();
		if(ipPort.trim() == "") {
			$("#ipPort").addClass("required");		
			if(focusNotSet){
				$("#ipPort").focus();
				focusNotSet = false;
			}
			formInvalid = true;
		} else if($("#ipPort").hasClass("required")) {
			$("#ipPort").removeClass("required");		
		}
		
		var smppBindType = $("#SmppBindType").val();
		if(smppBindType == null) {
			$("#smppBindTypeBtnGrp").addClass("required");		
			if(focusNotSet){
				$("#smppBindTypeLabel").focus();
				focusNotSet = false;
			}
			formInvalid = true;
		} else if($("#smppBindTypeBtnGrp").hasClass("required")) {
			$("#smppBindTypeBtnGrp").removeClass("required");		
		}	
		
		var smppSessionType = $("#SmppSessionType").val();
		if(smppSessionType == null) {
			$("#smppSessionTypeBtnGrp").addClass("required");		
			if(focusNotSet){
				$("#smppSessionTypeLabel").focus();
				focusNotSet = false;
			}
			formInvalid = true;
		} else if($("#smppSessionTypeBtnGrp").hasClass("required")) {
			$("#smppSessionTypeBtnGrp").removeClass("required");		
		}
		
		var systemType = $("#systemType").val();
		
		var smppVersion = $("#SmppVersion").val();
		if(smppVersion == null) {
			$("#versionBtnGrp").addClass("required");		
			if(focusNotSet){
				$("#versionLabel").focus();
				focusNotSet = false;
			}
			formInvalid = true;
		} else if($("#versionBtnGrp").hasClass("required")) {
			$("#versionBtnGrp").removeClass("required");		
		}		
		
		
		var esmeTon = $("#esmeTon").val();
		var esmeNpi = $("#esmeNpi").val();
		var esmeRange = $("#esmeRange").val();
		var clusterName = $("#clusterName").val();
		var windowSize = $("#windowSize").val();
		if(windowSize == null){
			windowSize = "1";//SmppConstants.DEFAULT_WINDOW_SIZE
		}

		var connectTimeout = $("#connectTimeout").val();
		if(connectTimeout == null){
			connectTimeout = "10000";
		}
		
		var reqExpTimeout = $("#reqExpTimeout").val();
		if(reqExpTimeout == null){
			reqExpTimeout = "-1";
		}
		
		var windowMonitorInterval = $("#windowMonitorInterval").val();
		if(windowMonitorInterval == null){
			windowMonitorInterval = "-1";
		}
		
		var windowWaitTimeout = $("#windowWaitTimeout").val();
		if(windowWaitTimeout == null){
			windowWaitTimeout = "60000";
		}
		
		var countersEnabled = $("#CountersEnabled").val();
		if(countersEnabled == null) {
			$("#countersEnabledBtnGrp").addClass("required");		
			if(focusNotSet){
				$("#countersEnabledBtnGrp").focus();
				focusNotSet = false;
			}
			formInvalid = true;
		} else if($("#countersEnabledBtnGrp").hasClass("required")) {
			$("#countersEnabledBtnGrp").removeClass("required");		
		}
		
		var enqLinkDelay = $("#enqLinkDelay").val();
		if(enqLinkDelay == null){
			enqLinkDelay = "30000";
		}
		
		if(formInvalid) {
			$("#login-settings-error").show();
			logToConsole("ERROR", "Some Fields are not correctly filled out, please double check the settings !");
			return false;
		} else {
			$("#login-settings-error").hide();
		}
		
		jolokia.execute("com.telscale.smsc:layer=EsmeManagement,name=SmscManagement","createEsme(java.lang.String,java.lang.String,java.lang.String,java.lang.String,int,java.lang.String,java.lang.String,java.lang.String,byte,byte,java.lang.String,java.lang.String,int,long,long,long,long,java.lang.String,boolean,int)", esmeName,systemId,password,ipAddress,ipPort,smppBindType,systemType,smppVersion,esmeTon,esmeNpi,esmeRange,smppSessionType,windowSize,connectTimeout,reqExpTimeout,windowMonitorInterval,windowWaitTimeout,clusterName,countersEnabled,enqLinkDelay, 
				{
					success: function(value) {
						updateEsmes();
						logToConsole('INFO', 'ESME ' + esmeName + ' created successfuly.');
						$('#entities-modal').modal('hide');
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}					
				});		
		
	}
	$(document).ready(function () {
		updateEsmes();
	});
</script>
