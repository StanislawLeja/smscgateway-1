
<h3 style="margin: 0px;">
	<i class="icon-resize-small"></i> External Short Messaging Entities
</h3>
<hr style="margin: 10 0px;" />
<span style="float: right;">
	<button id="refresh" style="float: right; margin-right: 20px; margin-left: 20px; height: 30px;" class="btn btn-medium btn-success" data-toggle="tooltip" data-placement="left" title="Refresh ESME List" onclick="updateEsmes();">
		<i class="icon-refresh"></i>
	</button>
</span>
<span id="esmes-table-wrapper">
	<table id="no-esmes-table" class="table" style="display: none;">
		<tr>
			<td>
				<div class="alert alert-info fade in">
					<strong>No ESME!</strong> 
				</div>
			</td>
		</tr>
	</table>

	<table id="esmes-table" class="table table-hover">
		<thead>
			<tr>
				<th style="width: 30px;">&nbsp;</th>
				<th>Name</th>
				<th>SystemId</th>
				<th>Type</th>
				<th>State</th>
				<th style="text-align: center; width: 150px;">Actions</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
	<p>
		<a href="#entities-modal" role="button" class="btn btn-info btn-small" data-toggle="modal" ><i class="icon-external-link"></i> Create ESME</a>
	</p>	
</span>

<div id="entities-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		<h3>Create ESME</h3>
	</div>
	<div id="entities-modal-body" class="modal-body">
		<div class="alert alert-error" id="login-settings-error" style="display:none;">
		  <button type="button" class="close">&times;</button>
		  Some Fields are not correctly filled out, please double check the settings below !
		</div>
		<p>
			<span>
				<div id="div-esmeName" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="unique name for this ESME">
						<span class="add-on">ESME Name</span>
						<input id="esmeName" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" placeholder="ESME Name" />
					</span>				
				</div>
				
				<div id="div-systemId" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="is used to identify an ESME or an SMSC at bind time. An ESME system_id identifies the ESME or ESME agent to the SMSC. The SMSC system_id provides an identification of the SMSC to the ESME.">
						<span class="add-on">System Id</span>
						<input id="systemId" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" placeholder="System Id" />
					</span>								
				</div>
				
				<div id="div-password" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="is used by the SMSC to authenticate the identity of the binding ESME. The Service Provider may require ESMEâ€™s to provide a password when binding to the SMSC">
						<span class="add-on">Password</span>
						<input id="password" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" placeholder="Password" />
					</span>					
				</div>
				
				<div id="div-ipAddress" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SMSC is acting as ESME, the BIND request will be sent to configured ip and port. If SMSC is acting as Server, it will accept incoming BIND request from specified IP and Port. If port is unknown, pass -1 as willd character">
						<span class="add-on">IP Address</span>
						<input id="ipAddress" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" placeholder="IP Address" />
					</span>					
				</div>
				
				<div id="div-ipPort" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SMSC is acting as ESME, the BIND request will be sent to configured ip and port. If SMSC is acting as Server, it will accept incoming BIND request from specified IP and Port. If port is unknown, pass -1 as willd character">
						<span class="add-on">Port</span>
						<input id="ipPort" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" placeholder="Port" />
					</span>	
				</div>
				
				<div id="div-smppBindTypeBtnGrp" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SMSC is acting as ESME, it will initiate corresponding bind else if its server it will accept corresponding bind from remote ESME">
						<span class="add-on">Smpp Bind Type</span>
						<select id="smppBindType" >
							<option>TRANSCEIVER</option>
							<option>TRANSMITTER</option>
							<option>RECEIVER</option>
						</select>
					</span>
				</div>

				<div id="div-smppSessionTypeBtnGrp" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SERVER, SMSC acts as server listening for incoming SMPP binds. If CLIENT, SMSC will initiate SMPP bind to remote server">
						<span class="add-on">Smpp Session Type</span>
						<select id="smppSessionType" >
							<option>CLIENT</option>
							<option>SERVER</option>
						</select>
					</span>
				</div>

				<div id="div-systemType" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="is used to categorize the type of ESME that is binding to the SMSC">
						<span class="add-on">System Type</span>
						<input id="systemType" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" placeholder="System Type" />
					</span>	
				</div>
				
				<div id="div-version" class="control-group">		
				
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="indicate the version of the SMPP protocol">
						<span class="add-on">Version</span>
						<select id="version" >
							<option>3.3</option>
							<option selected="selected">3.4</option>
							<option>5.0</option>
						</select>
					</span>
				</div>
				
				<div id="div-esmeTon" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SMSC is acting as server, esme-ton for incoming BIND request should match with configured value. If SMSC is initiating BIND then this value will be included in bind request">
						<span class="add-on">ESME Type of number (TON)</span>
						<select id="esmeTon" >
							<option value="0">Unknown</option>
							<option value="1">International</option>
							<option value="2">National</option>
							<option value="3">Network Specific</option>
							<option value="4">Subscriber Number</option>
							<option value="5">Alphanumeric</option>
							<option value="6">Abbreviated</option>
							<option value="7">Reserved</option>
						</select>
					</span>	
				</div>
								
				<div id="div-esmeNpi" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SMSC is acting as server, esme-npi for incoming BIND request should match with configured value. If SMSC is initiating BIND then this value will be included in bind request.">
						<span class="add-on">ESME Number plan indicator (NPI)</span>
						<select id="esmeNpi" >
							<option value="0">Unknown</option>
							<option value="1">ISDN (E163/E164)</option>
							<option value="3">Data (X.121)</option>
							<option value="4">Telex (F.69)</option>
							<option value="6">Land Mobile (E.212)</option>
							<option value="8">National</option>
							<option value="9">Private</option>
							<option value="10">ERMES</option>
							<option value="14">Internet (IP)</option>
							<option value="18">WAP Client Id</option>
						</select>
					</span>	
				</div>				
				
				<div id="div-esmeRange" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SMSC is acting as server, incoming bind request's esme-range should match with configured one. If incoming doesn't carry esme-range, one defined here will be used. If SMSC is acting as client, the bind request initiated will carry this esme-range.">
						<span class="add-on">ESME Range</span>
						<input id="esmeRange" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" placeholder="ESME Range" value="^[0-9a-zA-Z]*"/>
					</span>	
				</div>
	
				<div id="div-clusterName" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="its possible to group different SMPP connections together by specifying same cluster-name. All the SMPP connection 's that are capable of sending out SMS are candidates for grouping ">
						<span class="add-on">Cluster Name</span>
						<input id="clusterName" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" placeholder="Cluster Name" />
					</span>	
				</div>
					
				<div id="div-windowSize" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="window size is the amount of unacknowledged requests that are permitted to be outstanding/unacknowledged at any given time. If more requests are added, underlying stack will throw exception. This value is set only when ESME is defined as Client side. For Server side this value is taken from SMPP Server Setting">
						<span class="add-on">Windows Size</span>
						<input id="windowSize" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" placeholder="Windows Size" value="1"/>
					</span>	
				</div>
													
				<div id="div-connectTimeout" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="Time within which the connection to remote SMSCR server should be established. This is useful only when ESME is defined as Client Side. For Server side this value is taken from SMPP Server Setting.">
						<span class="add-on">Connect Timeout</span>
						<input id="connectTimeout" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" placeholder="Connect Timeout" value="10000"/>
					</span>	
				</div>
												
				<div id="div-reqExpTimeout" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="Amount of time to wait in milli seconds for an endpoint to respond to before it expires. -1 is disabled. This is useful only when ESME is defined as Client Side. For Server side this value is taken from SMPP Server Setting.">
						<span class="add-on">Request Expiry Timeout</span>
						<input id="reqExpTimeout" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" placeholder="Request Expiry Timeout" value="-1"/>
					</span>	
				</div>
							
				<div id="div-windowMonitorInterval" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="Amount of time between executions of monitoring the window for requests that expire. It's recommended that this generally either matches or is half the value of request-expiry-timeout. Therefore, at worst a request would could take up 1.5X the requestExpiryTimeout to clear out. -1 is disabled. This is useful only when ESME is defined as Client Side. For Server side this value is taken from SMPP Server Setting.">
						<span class="add-on">Windows Monitor Interval</span>
						<input id="windowMonitorInterval" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" placeholder="Windows Monitor Interval" value="-1"/>
					</span>	
				</div>
											
				<div id="div-windowWaitTimeout" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="Amount of time to wait until a slot opens up in the sendWindow. This is useful only when ESME is defined as Client Side. For Server side this value is taken from SMPP Server Setting.">
						<span class="add-on">Windows Wait Timeout</span>
						<input id="windowWaitTimeout" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" placeholder="Windows Wait Timeout" value="60000"/>
					</span>	
				</div>

				<div id="div-countersEnabled" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="SMSC exposes the statistics for SMPP connections. This is useful only when ESME is defined as Client Side. For Server side this value is taken from SMPP Server Setting.">
						<span class="add-on">Counters Enabled</span>
						<select id="countersEnabled" >
							<option>True</option>
							<option>False</option>
						</select>
					</span>
				</div>
							
				
				<div id="realform"></div>

				<div id="div-enqLinkDelay" class="control-group">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="When SMSC connects to remote server as CLIENT, it sends ENQUIRE_LINK every configured enquire-link-delay">
						<span class="add-on">Enquire Link Delay</span>
						<input id="enqLinkDelay" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" placeholder="Enquire Link Delay" value="30000"/>
					</span>	
				</div>
																																																																				
				<button id="add-entity-button" class="btn btn btn-primary" onclick="createEsme()">Create</button>
			</span>
		</p>
		<p>&nbsp;</p>
		<div class="accordion" id="entities-accordion">
		</div>
	</div>
	<div class="modal-footer">
		<a href="#" onclick="$('#entities-modal').modal('hide'); return false;" class="btn">Close</a>
	</div>
</div>

<script type="text/javascript">
$(function () {
    $('div.btn-group button[data-name]').on('click', function() {
        var select = $(this).data('name').split(',');
        var elem = $('#realform > input[name="'+select[0]+'"]');
        if(elem.length != 0)
            elem.remove();
        if(elem.attr('value') != select[1])
            $('<input type="hidden" id="'+select[0]+'" name="'+select[0]+'" value="'+select[1]+'" />').appendTo('#realform');
    });
});
	function updateEsmes() {
		mbeanSearch="com.telscale.smsc:layer=Esme,name=*";
		var mbeanVar;
		$.ajax({
			dataType: "json",
			url: window.jolokiaProtocol + "//" + window.jolokiaAddress + ":" + window.jolokiaPort + "/jolokia/search/" + mbeanSearch
		})
		.done(function(html) {
			if (html.error) {
				logToConsole("ERROR", html.error);
			}
			else {		
				
				$('.service-row').remove();
				$('.text-info').remove();
				jQuery.each(html.value, function() {
					mbeanVar = this;
					
					
					jolokia.request(
							[
								{ type: "read", mbean: mbeanVar },
							],
							{ success: [
								function(response) {
									
									var isSmppServerStarted = response.value.Started;
									
									var name = response.value.Name;
									var clusterName = response.value.ClusterName;
									
									var esmeAddress = response.value.Address;
									
									
									var systemId = response.value.SystemId;
									var localType = response.value.LocalTypeName;
									var state = response.value.StateName;
									
									var systemType = response.value.SystemType;
									var bindType = response.value.BindTypeName;
									var interfaceVersion = response.value.InterfaceVersionName;
									var password = response.value.Password;
									
									var windowSize = response.value.WindowSize;
									var requestExpiryTimeout = response.value.RequestExpiryTimeout;
									var windowMonitorInterval = response.value.WindowMonitorInterval;
									var windowWaitTimeout = response.value.WindowWaitTimeout;
									var maxWindowSize = response.value.MaxWindowSize;
									var windowMonitorEnabled = response.value.WindowMonitorEnabled;
									
									var boundDuration = response.value.BoundDuration;
									var rxDataSMCounter = response.value.RxDataSMCounter;
									var rxDeliverSMCounter = response.value.RxDeliverSMCounter;
									var rxEnquireLinkCounter = response.value.RxEnquireLinkCounter;
									var rxSubmitSMCounter = response.value.RxSubmitSMCounter;
									var txDataSMCounter = response.value.TxDataSMCounter;
									var txDeliverSMCounter = response.value.TxDeliverSMCounter;
									var txEnquireLinkCounter = response.value.TxEnquireLinkCounter;
									var txSubmitSMCounter = response.value.TxSubmitSMCounter;
									
									var localAddressAndPort = response.value.LocalAddressAndPort;
									var remoteAddressAndPort = response.value.RemoteAddressAndPort;
									var remoteTypeName = response.value.RemoteTypeName;
									
									var bound = response.value.Bound;
									var closed = response.value.Closed;
									var binding = response.value.Binding;
									var unbinding = response.value.Unbinding;	
									
									
									if(systemType == null || systemType==""){
										systemType = "null";
									}
									
									serviceClass = isSmppServerStarted ? 'active-service' : 'inactive-service';
									
									$('#esmes-table').children('tbody').append('<tr class="service-row"><td style="vertical-align: middle; text-align: center;"><i style="color: ' + (isSmppServerStarted ? '#51A351' : '#BD362F') + ';" class="' + (isSmppServerStarted ? 'icon-play-circle' : 'icon-remove-circle') + '"></i></td>'+
											'<td style="cursor: pointer;" onclick="$(this).parent().next().toggle();">' + name + '</td>' +
											'<td style="cursor: pointer;" onclick="$(this).parent().next().toggle();">' + systemId + '</td>' +
											'<td style="cursor: pointer;" onclick="$(this).parent().next().toggle();">' + localType + '</td>' +
											'<td style="cursor: pointer;" onclick="$(this).parent().next().toggle();">' + state + '</td>' +
											'<td style="font-size: 16px; vertical-align: middle; text-align: center; width: 150px;">' + 
												'<button class="btn btn-small btn-success"' + (isSmppServerStarted ? 'disabled' : '') + ' data-toggle="tooltip" title="Start ESME" data-placement="bottom" onclick="esmeOperation(\'startEsme\', \'' + name + '\')"><i class="icon-play"> </i></button> ' +
												'<button class="btn btn-small btn-danger"' + (!isSmppServerStarted ? 'disabled' : '') + ' data-toggle="tooltip" title="Stop ESME" data-placement="bottom" onclick="esmeOperation(\'stopEsme\', \'' + name +  '\')"><i class="icon-stop"> </i></button> ' +
												'<button class="btn btn-small btn-danger"' + (isSmppServerStarted ? 'disabled' : '') + ' data-toggle="tooltip" title="Remove ESME" data-placement="bottom" onclick="esmeOperation(\'destroyEsme\', \'' + name +  '\')"><i class="icon-remove"> </i></button> ' +
											'</td></tr>'+


											'<tr class="text-info" style="display: none;"><td colspan=6>' +
											'<div class="bs-docs-example bs-docs-example-submenus"> '+
									        '    <div>'+
									        '      <p class="muted">SMPP Properties</p>'+
													'<dl class="dl-horizontal" style="font-size: 0.8em;">' +
														'<dt>ClusterName</dt> <dd>' + clusterName + ' </dd>' + 
														'<dt>SystemType</dt> <dd>' + systemType + ' </dd>' + 
														'<dt>BindType</dt> <dd>' + bindType + ' </dd>' + 
														'<dt>InterfaceVersion</dt> <dd>' + interfaceVersion + ' </dd>' + 
														'<dt>Password</dt> <dd>' + password + ' </dd>' + 
													'</dl>'+
									        '    </div>'+
								        		'<hr style="margin: 5px 0;"/>' +
										        '    <div>'+
										        '      <p class="muted">ESME Address</p>'+
														'<dl class="dl-horizontal" style="font-size: 0.8em;">' +
															'<dt>TypeOfNumber</dt> <dd>' + esmeAddress.ton + ' </dd>' +
															'<dt>NumberPlanIndicator</dt> <dd>' + esmeAddress.npi + ' </dd>' +
															'<dt>AddressRange</dt> <dd>' + esmeAddress.address + ' </dd>' +
														'</dl>'+
										        '    </div>'+				        		
									        	'<hr style="margin: 5px 0;"/>' +
									        '    <div>'+
									        '      <p class="muted">Configuration</p>'+
													'<dl class="dl-horizontal" style="font-size: 0.8em;">' +
														'<dt>WindowSize</dt> <dd>' + windowSize + ' </dd>' +
														'<dt>RequestExpiryTimeout</dt> <dd>' + requestExpiryTimeout + ' </dd>' +
														'<dt>WindowMonitorInterval</dt> <dd>' + windowMonitorInterval + ' </dd>' +
														'<dt>WindowWaitTimeout</dt> <dd>' + windowWaitTimeout + ' </dd>' +
														'<dt>MaxWindowSize</dt> <dd>' + maxWindowSize + ' </dd>' +
														'<dt>WindowMonitorEnabled</dt> <dd>' + windowMonitorEnabled + ' </dd>' +
													'</dl>'+
									        '    </div>'+	
									        '<hr style="margin: 5px 0;"/>' +
									        '    <div>'+
									        '      <p class="muted">Statistics</p>'+
													'<dl class="dl-horizontal" style="font-size: 0.8em;">' +
													'<dt>BoundDuration</dt> <dd>' + boundDuration + ' </dd>' +
													'<dt>RxDataSMCounter</dt> <dd>' + rxDataSMCounter + ' </dd>' +
													'<dt>RxDeliverSMCounter</dt> <dd>' + rxDeliverSMCounter + ' </dd>' +
													'<dt>RxEnquireLinkCounter</dt> <dd>' + rxEnquireLinkCounter + ' </dd>' +
													'<dt>RxSubmitSMCounter</dt> <dd>' + rxSubmitSMCounter + ' </dd>' +
													'<dt>TxDataSMCounter</dt> <dd>' + txDataSMCounter + ' </dd>' +
													'<dt>TxDeliverSMCounter</dt> <dd>' + txDeliverSMCounter + ' </dd>' +
													'<dt>TxEnquireLinkCounter</dt> <dd>' + txEnquireLinkCounter + ' </dd>' +
													'<dt>TxSubmitSMCounter</dt> <dd>' + txSubmitSMCounter + ' </dd>' +
													'</dl>'+
									        '    </div>'+
									        '<hr style="margin: 5px 0;"/>' +
									        '    <div>'+
									        '      <p class="muted">Various</p>'+
													'<dl class="dl-horizontal" style="font-size: 0.8em;">' +
													'<dt>LocalAddressAndPort</dt> <dd>' + localAddressAndPort + ' </dd>' +
													'<dt>RemoteAddressAndPort</dt> <dd>' + remoteAddressAndPort + ' </dd>' +
													'<dt>RemoteTypeName</dt> <dd>' + remoteTypeName + ' </dd>' +
													'</dl>'+
									        '    </div>'+	
									        '<hr style="margin: 5px 0;"/>' +
									        '    <div>'+
									        '      <p class="muted">State</p>'+
													'<dl class="dl-horizontal" style="font-size: 0.8em;">' +
													'<dt>Bound</dt> <dd>' + bound + ' </dd>' +
													'<dt>Closed</dt> <dd>' + closed + ' </dd>' +
													'<dt>Binding</dt> <dd>' + binding + ' </dd>' +
													'<dt>Unbinding</dt> <dd>' + unbinding + ' </dd>' +
													'</dl>'+
									        '    </div>'+	
									        '<hr style="margin: 5px 0;"/>' +
									        '<div class="btn-group">'+
									        '              <button type="button" class="btn" onclick="disableLogBytes(\'' + name +  '\')"><i class="icon-ban-circle"></i> DisableLogBytes</button>'+
									        '              <button type="button" class="btn" onclick="disableLogPdu(\'' + name +  '\')"><i class="icon-ban-circle"></i> DisableLogPdu</button>'+
									        '              <button type="button" class="btn" onclick="dumpWindow(\'' + name +  '\')"><i class="icon-comment-alt"></i> DumpWindow</button>'+
									        '              <button type="button" class="btn" onclick="enableLogBytes(\'' + name +  '\')"><i class="icon-check"></i> EnableLogBytes</button>'+
									        '              <button type="button" class="btn" onclick="enableLogPdu(\'' + name +  '\')"><i class="icon-check"></i> EnableLogPdu</button>'+
									        '              <button type="button" class="btn" onclick="resetCounters(\'' + name +  '\')"><i class="icon-spinner"></i> ResetCounters</button>'+
									        '            </div>'+
									 		'</div>'+
									 		
											'</td></tr>'
									);									
									
								}],
								error: function(value){
									errorUID = ("st" + new Date().getTime()).hashCode();
									createStackTrace(errorUID, value.stacktrace);
									logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
								}
							}
						); 

				});
			}
		})
		.fail(function() {
			logToConsole("ERROR", "Failure trying to communicate with the SMSC Gateway. Please try again later.");
		})
	}
	function disableLogBytes(esmeName){
		mbeanSearch="com.telscale.smsc:layer=Esme,name="+esmeName;
		jolokia.execute(mbeanSearch,"disableLogBytes",
				{
					success: function(value) {
						logToConsole('INFO', 'Successfully disabled log bytes for Esme ' + esmeName );
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}
				});	
	}
	function disableLogPdu(esmeName){
		mbeanSearch="com.telscale.smsc:layer=Esme,name="+esmeName;
		jolokia.execute(mbeanSearch,"disableLogPdu",
				{
					success: function(value) {
						logToConsole('INFO', 'Successfully disabled log pdu for Esme ' + esmeName );
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}
				});	
	}	
	function dumpWindow(esmeName){
		mbeanSearch="com.telscale.smsc:layer=Esme,name="+esmeName;
		jolokia.execute(mbeanSearch,"dumpWindow",
				{
					success: function(value) {
						logToConsole('INFO', 'Successfully dumped window for Esme ' + esmeName );
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}
				});	
	}
	function enableLogBytes(esmeName){
		mbeanSearch="com.telscale.smsc:layer=Esme,name="+esmeName;
		jolokia.execute(mbeanSearch,"enableLogBytes",
				{
					success: function(value) {
						logToConsole('INFO', 'Successfully enabled log bytes for Esme ' + esmeName );
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}
				});	
	}	
	function enableLogPdu(esmeName){
		mbeanSearch="com.telscale.smsc:layer=Esme,name="+esmeName;
		jolokia.execute(mbeanSearch,"enableLogPdu",
				{
					success: function(value) {
						logToConsole('INFO', 'Successfully enabled log pdu for Esme ' + esmeName );
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}
				});	
	}	
	function resetCounters(esmeName){
		mbeanSearch="com.telscale.smsc:layer=Esme,name="+esmeName;
		jolokia.execute(mbeanSearch,"resetCounters",
				{
					success: function(value) {
						logToConsole('INFO', 'Successfully resetted counters for Esme ' + esmeName );
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}
				});	
	}	
	function esmeOperation(operation, name) {
		mbeanSearch="com.telscale.smsc:layer=EsmeManagement,name=SmscManagement";
		jolokia.execute(mbeanSearch,operation,name,
				{
					success: function(value) {
						updateEsmes();
						logToConsole('INFO', 'Successfully '+operation+'ed Esme ' + name );
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}
				});	
		
	}
	function createEsme(){
		var formInvalid = false;
		var focusNotSet = true;
		
		var esmeName = $("#esmeName").val();
		if(esmeName.trim() == "") {
			$("#div-esmeName").addClass("error");
			if(focusNotSet){
				$("#esmeName").focus();
				focusNotSet = false;
			}
			formInvalid = true;
		} else if($("#div-esmeName").hasClass("error")) {
			$("#div-esmeName").removeClass("error");		
		}
		
		var systemId = $("#systemId").val();
		if(systemId.trim() == "") {
			$("#div-systemId").addClass("error");
			if(focusNotSet){
				$("#systemId").focus();
				focusNotSet = false;
			}
			formInvalid = true;
		} else if($("#div-systemId").hasClass("error")) {
			$("#div-systemId").removeClass("error");		
		}
		
		var password = $("#password").val();
		if(password.trim() == "") {
			$("#div-password").addClass("error");		
			if(focusNotSet){
				$("#password").focus();
				focusNotSet = false;
			}
			formInvalid = true;
		} else if($("#div-password").hasClass("error")) {
			$("#div-password").removeClass("error");		
		}
		
		var ipAddress = $("#ipAddress").val();
		if(ipAddress.trim() == "") {
			$("#div-ipAddress").addClass("error");		
			if(focusNotSet){
				$("#ipAddress").focus();
				focusNotSet = false;
			}
			formInvalid = true;
		} else if($("#div-ipAddress").hasClass("error")) {
			$("#div-ipAddress").removeClass("error");		
		}
		
		var ipPort = $("#ipPort").val();
		if(ipPort.trim() == "") {
			$("#div-ipPort").addClass("error");		
			if(focusNotSet){
				$("#ipPort").focus();
				focusNotSet = false;
			}
			formInvalid = true;
		} else if($("#div-ipPort").hasClass("error")) {
			$("#div-ipPort").removeClass("error");		
		}

		var e = document.getElementById("smppBindType");
		var smppBindType = e.options[e.selectedIndex].text;
		
		var e1 = document.getElementById("smppSessionType");
		var smppSessionType = e1.options[e.selectedIndex].text;		
		
		var systemType = $("#systemType").val();
		
		
		var e2 = document.getElementById("version");
		var smppVersion = e2.options[e.selectedIndex].text;	
		
		var e3 = document.getElementById("esmeTon");
		var esmeTon = e3.options[e.selectedIndex].value;	
		
		var e4 = document.getElementById("esmeNpi");
		var esmeNpi = e4.options[e.selectedIndex].value;
		
		var esmeRange = $("#esmeRange").val();
		var clusterName = $("#clusterName").val();
		var windowSize = $("#windowSize").val();
		
		if(windowSize == null){
			windowSize = "1";//SmppConstants.DEFAULT_WINDOW_SIZE
		}

		var connectTimeout = $("#connectTimeout").val();
		if(connectTimeout == null){
			connectTimeout = "10000";
		}
		
		var reqExpTimeout = $("#reqExpTimeout").val();
		if(reqExpTimeout == null){
			reqExpTimeout = "-1";
		}
		
		var windowMonitorInterval = $("#windowMonitorInterval").val();
		if(windowMonitorInterval == null){
			windowMonitorInterval = "-1";
		}
		
		var windowWaitTimeout = $("#windowWaitTimeout").val();
		if(windowWaitTimeout == null){
			windowWaitTimeout = "60000";
		}
		
		var e5 = document.getElementById("countersEnabled");
		var countersEnabled = e5.options[e.selectedIndex].text;	
		
		var enqLinkDelay = $("#enqLinkDelay").val();
		if(enqLinkDelay == null){
			enqLinkDelay = "30000";
		}
		
		if(formInvalid) {
			$("#login-settings-error").show();
			logToConsole("ERROR", "Some Fields are not correctly filled out, please double check the settings !");
			return false;
		} else {
			$("#login-settings-error").hide();
		}
		
		jolokia.execute("com.telscale.smsc:layer=EsmeManagement,name=SmscManagement","createEsme(java.lang.String,java.lang.String,java.lang.String,java.lang.String,int,java.lang.String,java.lang.String,java.lang.String,byte,byte,java.lang.String,java.lang.String,int,long,long,long,long,java.lang.String,boolean,int)", esmeName,systemId,password,ipAddress,ipPort,smppBindType,systemType,smppVersion,esmeTon,esmeNpi,esmeRange,smppSessionType,windowSize,connectTimeout,reqExpTimeout,windowMonitorInterval,windowWaitTimeout,clusterName,countersEnabled,enqLinkDelay, 
				{
					success: function(value) {
						updateEsmes();
						logToConsole('INFO', 'ESME ' + esmeName + ' created successfuly.');
						$('#entities-modal').modal('hide');
					},
					error: function(value){
						errorUID = ("st" + new Date().getTime()).hashCode();
						createStackTrace(errorUID, value.stacktrace);
						logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
					}					
				});		
		
	}
	$(document).ready(function () {
		updateEsmes();
	});
</script>
