					<h3 style="margin: 0px;"><i class="icon-dashboard"></i> SMSC Gateway Server Settings</h3>
					<hr style="margin: 10 0px;"/>

					<button id="apply-server-settings" class="btn btn-small" onclick="applyServerSettings()"><i class="icon-save" style="color: #000000;"></i>  Apply Changes</button>
					
					<p>
						<br/>
					</p> 
					
					<div class="alert alert-error" id="login-settings-error" style="display:none;">
					  <button type="button" class="close">&times;</button>
					  Some Fields are not correctly filled out, please double check the settings below !
					</div>
					
 					<p>
					<span id="mss-settings">
					<ul class="nav nav-tabs" id="myTab">
						<li class="active"><a href="#properties" data-toggle="tab">Properties</a></li>
  						<li><a href="#ss7settings" data-toggle="tab">SS7 settings</a></li>
  						<li><a href="#dbsettings" data-toggle="tab">Cassandra</a></li>
  						<li><a href="#scheduler" data-toggle="tab">Scheduler</a></li>
					</ul>	
						
  				 	<div class="tab-content">
                        <div class="tab-pane active" id="properties" style="margin-left: 10px;">
                        	
                        	<h5 style="border-bottom: 1px solid #DDD;">SMS Validity Configuration</h5> 
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SMS arrives without validity period, default validity period (in hours) will be used">
								<span class="add-on">Default validity period hours (in hours)</span>
								<input id="propdefaultvalidityhrs" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>
							&nbsp;
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SMS arrives with validity period greater than maximum validity period configured, it will be reset to maximum validity">
								<span class="add-on">Maximum validity period (in hours)</span>
								<input id="propmaxvalidityhrs" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>
							
                        	<h5 style="border-bottom: 1px solid #DDD;">SMPP/ESME Configuration</h5> 
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SMS is received via SMPP without TON, below configured TON will be used">
								<span class="add-on">Default type of number (TON)</span>
								<input id="propdefaultton" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>														
							&nbsp;
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SMS is received via SMPP without NPI, below configured NPI will be used">
								<span class="add-on">Default numbering plan indicator (NPI)</span>
								<input id="propdefaultnpi" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>
							&nbsp;
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if destinationAddress does not match to any esme (any ClusterName) or a message will be routed to defaultClusterName (only for DatabaseSmsRoutingRule) if it is specified">
								<span class="add-on">Cluster Name</span>
								<input id="esmedefaultclustername" type="text" class="input-mini" style="width: 160px; margin-right: 12px; text-align: center;" value="0" />
							</span>                         
                        	<h5 style="border-bottom: 1px solid #DDD;">Delivery Delay Configuration</h5> 
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="delay after delivering failure with cause subscriber busy (sec)">
								<span class="add-on">Subscriber busy due delay (in sec)</span>
								<input id="propsubbusduedel" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>														
							&nbsp;	
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="delay before first delivering try after incoming message receiving (sec) ">
								<span class="add-on">First due delay (in sec)</span>
								<input id="propfirduedel" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>														
							&nbsp;	
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="delay after first delivering failure (sec)">
								<span class="add-on">Second due delay (in sec)</span>
								<input id="propsecduedel" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>														
							&nbsp;																					                        
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="max possible delay between delivering failure (sec)">
								<span class="add-on">Max due delay (in sec)</span>
								<input id="propmaxduedel" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>														
							&nbsp;																					                        
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="next delay (after failure will be calculated as prevDueDelay * dueDelayMultiplicator / 100")">
								<span class="add-on">Due delay multiplicator</span>
								<input id="duedelaymultiplicator" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>														
							&nbsp;							
                        </div>  				 	
                        <div class="tab-pane" id="ss7settings">
                        	<h5 style="border-bottom: 1px solid #DDD;">Global Title Configuration</h5>
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="SMSC Gateway Global Title">
								<span class="add-on">SMSC Gateway Global Title</span>
								<input id="ussdgt" type="text" class="input-mini" style="width: 160px; margin-right: 12px; text-align: center;" value="0" />
							</span>
							<h5 style="border-bottom: 1px solid #DDD;">Sub System Number Configuration</h5>        
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="SMSC Gateway subsystem number">
								<span class="add-on">SMSC Gateway subsystem number</span>
								<input id="ussdssn" type="text" class="input-mini" style="width: 30px; margin-right: 12px; text-align: center;" value="0" />
							</span>	
							&nbsp;
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="HLR subsystem number">
								<span class="add-on">HLR subsystem number</span>
								<input id="hlrssn" type="text" class="input-mini" style="width: 30px; margin-right: 12px; text-align: center;" value="0" />
							</span>	
							&nbsp;
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="MSC subsystem number">
								<span class="add-on">MSC subsystem number</span>
								<input id="mscssn" type="text" class="input-mini" style="width: 30px; margin-right: 12px; text-align: center;" value="0" />
							</span>
							<h5 style="border-bottom: 1px solid #DDD;">SS7 Version Configuration</h5>        						                		
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="this is MAP version supported. The outgoing message will be formed for this MAP version, if far end returns error indicating lower/highers version, SMSC Gw will automatically create new message with lower/highers version of MAP message">
								<span class="add-on">MAP version supported</span>
								<input id="maxmapv" type="text" class="input-mini" style="width: 30px; margin-right: 12px; text-align: center;" value="0" />
							</span>	
							<h5 style="border-bottom: 1px solid #DDD;">Others</h5>        						                		
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="empty TC-BEGIN will be used if messageLength > maxPossibleMessageLength - maxMessageLengthReduce. Recommended value = 6 Possible values from 0 to 12">
								<span class="add-on">Max Message Length Reducer</span>
								<input id="maxmessagelengthreducer" type="text" class="input-mini" style="width: 30px; margin-right: 12px; text-align: center;" value="0" />
							</span>								
                        </div>
                         <div class="tab-pane" id="dbsettings">
							<h5 style="border-bottom: 1px solid #DDD;">Cassandra Configuration</h5>
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="cassandra host address">
								<span class="add-on">Host Address</span>
								<input id="cassandrahost" type="text" class="input-mini" style="width: 160px; margin-right: 12px; text-align: center;" value="0" />
							</span>                         
							<br/><br/>
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="cassandra port">
								<span class="add-on">Port</span>
								<input id="cassandraport" type="text" class="input-mini" style="width: 100px; margin-right: 12px; text-align: center;" value="0" />
							</span>                         
							<br/><br/>
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="cassandra keyspace name">
								<span class="add-on">Keyspace Name</span>
								<input id="cassandrakeyspace" type="text" class="input-mini" style="width: 100px; margin-right: 12px; text-align: center;" value="0" />
							</span>                         
							<br/><br/>
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="cassandra cluster name">
								<span class="add-on">Cluster Name</span>
								<input id="cassandraclustername" type="text" class="input-mini" style="width: 100px; margin-right: 12px; text-align: center;" value="0" />
							</span>                         
							<br/><br/>							
																					
                        </div>
                        <div class="tab-pane" id="scheduler">
							<h5 style="border-bottom: 1px solid #DDD;">Scheduler Configuration</h5>
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="period of fetching messages from a database for delivering">
								<span class="add-on">Fetch Period (in ms)</span>
								<input id="schedulerfetchperiod" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span> 
							&nbsp;
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="max message fetching count for one fetching step">
								<span class="add-on">Max Rows</span>
								<input id="schedulerfetchmaxrows" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span> 
							&nbsp;
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="max count of delivering Activities that are possible at the same time">
								<span class="add-on">Max Activity Count</span>
								<input id="schedulerfetchmaxactivity" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span> 
                        </div>                        
					</div>	
					</span>					 
				</p>	
				<script type="text/javascript">
					$('#login-settings-error .close').on("click", function(e) {
					    $(this).parent().hide();
					});
				
					$(document).ready(function () {												
						mbeanSearch="com.telscale.smsc:layer=SmscPropertiesManagement,name=SmscManagement";
						jolokia.request(
								[
									{ type: "read", mbean: mbeanSearch },
								],
								{ success: [
									function(response) {
										$("#propdefaultvalidityhrs").val(response.value.DefaultValidityPeriodHours);
										$("#propmaxvalidityhrs").val(response.value.MaxValidityPeriodHours);
										$("#propdefaultton").val(response.value.DefaultTon);
										$("#propdefaultnpi").val(response.value.DefaultNpi);
										
										$("#esmedefaultclustername").val(response.value.EsmeDefaultClusterName);
										
										$("#propsubbusduedel").val(response.value.SubscriberBusyDueDelay);
										$("#propfirduedel").val(response.value.FirstDueDelay);
										$("#propsecduedel").val(response.value.SecondDueDelay);
										$("#propmaxduedel").val(response.value.MaxDueDelay);
										
										$("#duedelaymultiplicator").val(response.value.DueDelayMultiplicator);
										
										$("#ussdgt").val(response.value.ServiceCenterGt);
										$("#ussdssn").val(response.value.ServiceCenterSsn);
										$("#hlrssn").val(response.value.HlrSsn);
										$("#mscssn").val(response.value.MscSsn);
										$("#maxmapv").val(response.value.MaxMapVersion);
										$("#maxmessagelengthreducer").val(response.value.MaxMessageLengthReducer);
										
										
										var hosts = response.value.Hosts;
										var hostportarr = hosts.split(":");
										var cassandrahost = hostportarr[0] 
										var cassandraport = hostportarr[1]
										
										
										$("#cassandrahost").val(cassandrahost);
										$("#cassandraport").val(cassandraport);
										$("#cassandrakeyspace").val(response.value.KeyspaceName);
										$("#cassandraclustername").val(response.value.ClusterName);
										
										$("#schedulerfetchperiod").val(response.value.FetchPeriod);
										$("#schedulerfetchmaxrows").val(response.value.FetchMaxRows);
										$("#schedulerfetchmaxactivity").val(response.value.MaxActivityCount);										
										
									}],
									error: function(value) {
										errorUID = ("st" + new Date().getTime()).hashCode();
										createStackTrace(errorUID, value.stacktrace);
										logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");										
									} 
								}
							);						
					
	    			});
					
					function applyServerSettings() {
						var formInvalid = false;
						
						var propdefaultvalidityhrs = $("#propdefaultvalidityhrs").val();
						if(propdefaultvalidityhrs.trim() == "") {
			    			$("#propdefaultvalidityhrs").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propdefaultvalidityhrs").hasClass("required")) {
			    			$("#propdefaultvalidityhrs").removeClass("required");		
			    		}
						
						var propmaxvalidityhrs = $("#propmaxvalidityhrs").val();
						if(propmaxvalidityhrs.trim() == "") {
			    			$("#propmaxvalidityhrs").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propmaxvalidityhrs").hasClass("required")) {
			    			$("#propmaxvalidityhrs").removeClass("required");		
			    		}
						
						var propdefaultton = $("#propdefaultton").val();
						if(propdefaultton.trim() == "") {
			    			$("#propdefaultton").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propdefaultton").hasClass("required")) {
			    			$("#propdefaultton").removeClass("required");		
			    		}
						
						var propdefaultnpi = $("#propdefaultnpi").val();
						if(propdefaultnpi.trim() == "") {
			    			$("#propdefaultnpi").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propdefaultnpi").hasClass("required")) {
			    			$("#propdefaultnpi").removeClass("required");		
			    		}
						
						var propesmedefaultclustername = $("#esmedefaultclustername").val();
						
						var propsubbusduedel = $("#propsubbusduedel").val();
						if(propsubbusduedel.trim() == "") {
			    			$("#propsubbusduedel").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propsubbusduedel").hasClass("required")) {
			    			$("#propsubbusduedel").removeClass("required");		
			    		}
						
						var propfirduedel = $("#propfirduedel").val();
						if(propfirduedel.trim() == "") {
			    			$("#propfirduedel").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propfirduedel").hasClass("required")) {
			    			$("#propfirduedel").removeClass("required");		
			    		}
						
						var propsecduedel = $("#propsecduedel").val();
						if(propsecduedel.trim() == "") {
			    			$("#propsecduedel").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propsecduedel").hasClass("required")) {
			    			$("#propsecduedel").removeClass("required");		
			    		}
						
						var propmaxduedel = $("#propmaxduedel").val();
						if(propmaxduedel.trim() == "") {
			    			$("#propmaxduedel").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propmaxduedel").hasClass("required")) {
			    			$("#propmaxduedel").removeClass("required");		
			    		}
						
						var duedelaymultiplicator = $("#duedelaymultiplicator").val();
						if(duedelaymultiplicator.trim() == "") {
			    			$("#duedelaymultiplicator").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#duedelaymultiplicator").hasClass("required")) {
			    			$("#duedelaymultiplicator").removeClass("required");		
			    		}
						
						
						var cassandrahost = $("#cassandrahost").val();
						if(cassandrahost.trim() == "") {
			    			$("#cassandrahost").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#cassandrahost").hasClass("required")) {
			    			$("#cassandrahost").removeClass("required");		
			    		}
						
						var cassandraport = $("#cassandraport").val();
						if(cassandraport.trim() == "") {
			    			$("#cassandraport").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#cassandraport").hasClass("required")) {
			    			$("#cassandraport").removeClass("required");		
			    		}
						
						var hosts = cassandrahost + ":" + cassandraport;
						
						var cassandrakeyspace = $("#cassandrakeyspace").val();
						if(cassandrakeyspace.trim() == "") {
			    			$("#cassandrakeyspace").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#cassandrakeyspace").hasClass("required")) {
			    			$("#cassandrakeyspace").removeClass("required");		
			    		}
						
						var cassandraclustername = $("#cassandraclustername").val();
						
						
						var ussdgt = $("#ussdgt").val();
						if(ussdgt.trim() == "") {
			    			$("#ussdgt").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#ussdgt").hasClass("required")) {
			    			$("#ussdgt").removeClass("required");		
			    		}
						
						var ussdssn = $("#ussdssn").val();
						if(ussdssn.trim() == "") {
			    			$("#ussdssn").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#ussdssn").hasClass("required")) {
			    			$("#ussdssn").removeClass("required");		
			    		}		
						
						var hlrssn = $("#hlrssn").val();
						if(hlrssn.trim() == "") {
			    			$("#hlrssn").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#hlrssn").hasClass("required")) {
			    			$("#hlrssn").removeClass("required");		
			    		}	
						
						var mscssn = $("#mscssn").val();
						if(mscssn.trim() == "") {
			    			$("#mscssn").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#mscssn").hasClass("required")) {
			    			$("#mscssn").removeClass("required");		
			    		}
						
						var maxmapv = $("#maxmapv").val();
						if(maxmapv.trim() == "") {
			    			$("#maxmapv").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#maxmapv").hasClass("required")) {
			    			$("#maxmapv").removeClass("required");		
			    		}
						
						var maxmessagelengthreducer = $("#maxmessagelengthreducer").val();
						if(maxmessagelengthreducer.trim() == "") {
			    			$("#maxmessagelengthreducer").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#maxmessagelengthreducer").hasClass("required")) {
			    			$("#maxmessagelengthreducer").removeClass("required");		
			    		}
						
						var schedulerfetchperiod = $("#schedulerfetchperiod").val();
						if(schedulerfetchperiod.trim() == "") {
			    			$("#schedulerfetchperiod").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#schedulerfetchperiod").hasClass("required")) {
			    			$("#schedulerfetchperiod").removeClass("required");		
			    		}
						
						var schedulerfetchmaxrows = $("#schedulerfetchmaxrows").val();
						if(schedulerfetchmaxrows.trim() == "") {
			    			$("#schedulerfetchmaxrows").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#schedulerfetchmaxrows").hasClass("required")) {
			    			$("#schedulerfetchmaxrows").removeClass("required");		
			    		}
						
						var schedulerfetchmaxactivity = $("#schedulerfetchmaxactivity").val();
						if(schedulerfetchmaxactivity.trim() == "") {
			    			$("#schedulerfetchmaxactivity").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#schedulerfetchmaxactivity").hasClass("required")) {
			    			$("#schedulerfetchmaxactivity").removeClass("required");		
			    		}
						
						if(formInvalid) {
							$("#login-settings-error").show();
							logToConsole("ERROR", "Some Fields are not correctly filled out, please double check the settings !");
							return false;
						} else {
							$("#login-settings-error").hide();
						}
						
						
						mbeanSearch="com.telscale.smsc:layer=SmscPropertiesManagement,name=SmscManagement";
						jolokia.request(
								[
									{ type: "write", mbean: mbeanSearch, attribute: "DefaultValidityPeriodHours", value: propdefaultvalidityhrs },
									{ type: "write", mbean: mbeanSearch, attribute: "MaxValidityPeriodHours", value: propmaxvalidityhrs },
									{ type: "write", mbean: mbeanSearch, attribute: "DefaultTon", value: propdefaultton },
									{ type: "write", mbean: mbeanSearch, attribute: "DefaultNpi", value: propdefaultnpi },
									{ type: "write", mbean: mbeanSearch, attribute: "EsmeDefaultClusterName", value: propesmedefaultclustername },
									{ type: "write", mbean: mbeanSearch, attribute: "SubscriberBusyDueDelay", value: propsubbusduedel },
									{ type: "write", mbean: mbeanSearch, attribute: "FirstDueDelay", value: propfirduedel },
									{ type: "write", mbean: mbeanSearch, attribute: "SecondDueDelay", value: propsecduedel },
									{ type: "write", mbean: mbeanSearch, attribute: "MaxDueDelay", value: propmaxduedel },
									{ type: "write", mbean: mbeanSearch, attribute: "DueDelayMultiplicator", value: duedelaymultiplicator },
									{ type: "write", mbean: mbeanSearch, attribute: "Hosts", value: hosts },
									{ type: "write", mbean: mbeanSearch, attribute: "KeyspaceName", value: cassandrakeyspace },
									{ type: "write", mbean: mbeanSearch, attribute: "ClusterName", value: cassandraclustername },
									{ type: "write", mbean: mbeanSearch, attribute: "ServiceCenterGt", value: ussdgt },
									{ type: "write", mbean: mbeanSearch, attribute: "ServiceCenterSsn", value: ussdssn },
									{ type: "write", mbean: mbeanSearch, attribute: "HlrSsn", value: hlrssn },
									{ type: "write", mbean: mbeanSearch, attribute: "MscSsn", value: mscssn },
									{ type: "write", mbean: mbeanSearch, attribute: "MaxMapVersion", value: maxmapv },
									{ type: "write", mbean: mbeanSearch, attribute: "MaxMessageLengthReducer", value: maxmessagelengthreducer },
									{ type: "write", mbean: mbeanSearch, attribute: "FetchPeriod", value: schedulerfetchperiod },
									{ type: "write", mbean: mbeanSearch, attribute: "FetchMaxRows", value: schedulerfetchmaxrows },
									{ type: "write", mbean: mbeanSearch, attribute: "MaxActivityCount", value: schedulerfetchmaxactivity },
								],
								{
									success: function(response) {
										logToConsole("INFO", "SMSC Gateway Proerties successfully updated.");
									},
									error: function(response) {
										logToConsole("ERROR", "Failure trying to communicate with the Telscale SMSC Gateway. Please try again later.");
									} 
								}
							);
									
					}
					</script>
