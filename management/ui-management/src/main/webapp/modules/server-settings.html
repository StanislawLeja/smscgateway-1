					<h3 style="margin: 0px;"><i class="icon-dashboard"></i> SMSC Gateway Server Settings</h3>
					<hr style="margin: 10 0px;"/>

					<button id="apply-server-settings" class="btn btn-small" onclick="applyServerSettings()"><i class="icon-save" style="color: #000000;"></i>  Apply Changes</button>
					
					<p>
						<br/>
					</p> 
					
					<div class="alert alert-error" id="login-settings-error" style="display:none;">
					  <button type="button" class="close">&times;</button>
					  Some Fields are not correctly filled out, please double check the settings below !
					</div>
					
 					<p>
					<span id="mss-settings">
					<ul class="nav nav-tabs" id="myTab">
						<li class="active"><a href="#properties" data-toggle="tab">Properties</a></li>
  						<li><a href="#ss7settings" data-toggle="tab">SS7 settings</a></li>
  						<li><a href="#dbsettings" data-toggle="tab">Cassandra</a></li>
  						<li><a href="#scheduler" data-toggle="tab">Scheduler</a></li>
					</ul>	
						
  				 	<div class="tab-content">
                        <div class="tab-pane active" id="properties" style="margin-left: 10px;">
                        	
                        	<h5 style="border-bottom: 1px solid #DDD;">SMS Validity Configuration</h5> 
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SMS arrives without validity period, default validity period (in hours) will be used">
								<span class="add-on">Default validity period hours (in hours)</span>
								<input id="propdefaultvalidityhrs" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>
							&nbsp;
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SMS arrives with validity period greater than maximum validity period configured, it will be reset to maximum validity">
								<span class="add-on">Maximum validity period (in hours)</span>
								<input id="propmaxvalidityhrs" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>
							
                        	<h5 style="border-bottom: 1px solid #DDD;">SMPP/ESME Configuration</h5> 
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SMS is received via SMPP without TON, below configured TON will be used">
								<span class="add-on">Default type of number (TON)</span>
								<input id="propdefaultton" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>														
							&nbsp;
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if SMS is received via SMPP without NPI, below configured NPI will be used">
								<span class="add-on">Default numbering plan indicator (NPI)</span>
								<input id="propdefaultnpi" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>
							&nbsp;
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="if destinationAddress does not match to any esme (any ClusterName) or a message will be routed to defaultClusterName (only for DatabaseSmsRoutingRule) if it is specified">
								<span class="add-on">Cluster Name</span>
								<input id="esmedefaultclustername" type="text" class="input-mini" style="width: 160px; margin-right: 12px; text-align: center;" value="0" />
							</span>                         
                        	<h5 style="border-bottom: 1px solid #DDD;">Delivery Delay Configuration</h5> 
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="delay after delivering failure with cause subscriber busy (sec)">
								<span class="add-on">Subscriber busy due delay (in sec)</span>
								<input id="propsubbusduedel" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>														
							&nbsp;	
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="delay before first delivering try after incoming message receiving (sec) ">
								<span class="add-on">First due delay (in sec)</span>
								<input id="propfirduedel" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>														
							&nbsp;	
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="delay after first delivering failure (sec)">
								<span class="add-on">Second due delay (in sec)</span>
								<input id="propsecduedel" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>														
							&nbsp;																					                        
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="max possible delay between delivering failure (sec)">
								<span class="add-on">Max due delay (in sec)</span>
								<input id="propmaxduedel" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>														
							&nbsp;																					                        
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="next delay (after failure will be calculated as prevDueDelay * dueDelayMultiplicator / 100")">
								<span class="add-on">Due delay multiplicator</span>
								<input id="duedelaymultiplicator" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span>														
							&nbsp;							
                        </div>  				 	
                        <div class="tab-pane" id="ss7settings">
                        	<h5 style="border-bottom: 1px solid #DDD;">Global Title Configuration</h5>
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="SMSC Gateway Global Title">
								<span class="add-on">SMSC Gateway Global Title</span>
								<input id="ussdgt" type="text" class="input-mini" style="width: 160px; margin-right: 12px; text-align: center;" value="0" />
							</span>
							<h5 style="border-bottom: 1px solid #DDD;">Sub System Number Configuration</h5>        
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="SMSC Gateway subsystem number">
								<span class="add-on">SMSC Gateway subsystem number</span>
								<input id="ussdssn" type="text" class="input-mini" style="width: 30px; margin-right: 12px; text-align: center;" value="0" />
							</span>	
							&nbsp;
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="HLR subsystem number">
								<span class="add-on">HLR subsystem number</span>
								<input id="hlrssn" type="text" class="input-mini" style="width: 30px; margin-right: 12px; text-align: center;" value="0" />
							</span>	
							&nbsp;
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="MSC subsystem number">
								<span class="add-on">MSC subsystem number</span>
								<input id="mscssn" type="text" class="input-mini" style="width: 30px; margin-right: 12px; text-align: center;" value="0" />
							</span>
							<h5 style="border-bottom: 1px solid #DDD;">SS7 Version Configuration</h5>        						                		
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="this is MAP version supported. The outgoing message will be formed for this MAP version, if far end returns error indicating lower/highers version, SMSC Gw will automatically create new message with lower/highers version of MAP message">
								<span class="add-on">MAP version supported</span>
								<input id="maxmapv" type="text" class="input-mini" style="width: 30px; margin-right: 12px; text-align: center;" value="0" />
							</span>	
                        </div>
                         <div class="tab-pane" id="dbsettings">
							<h5 style="border-bottom: 1px solid #DDD;">Cassandra Configuration</h5>
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="Cassandra Host Address">
								<span class="add-on">Host Address</span>
								<input id="cassandrahost" type="text" class="input-mini" style="width: 160px; margin-right: 12px; text-align: center;" value="0" />
							</span>                         
							<br/><br/>
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="Cassandra Port">
								<span class="add-on">Port</span>
								<input id="cassandraport" type="text" class="input-mini" style="width: 100px; margin-right: 12px; text-align: center;" value="0" />
							</span>                         
							<br/><br/>
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="Cassandra Keyspace Name">
								<span class="add-on">Keyspace Name</span>
								<input id="cassandrakeyspace" type="text" class="input-mini" style="width: 100px; margin-right: 12px; text-align: center;" value="0" />
							</span>                         
							<br/><br/>
							
																					
                        </div>
                        <div class="tab-pane" id="scheduler">
							<h5 style="border-bottom: 1px solid #DDD;">Scheduler Configuration</h5>
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="period of fetching messages from a database for delivering">
								<span class="add-on">Fetch Period (in ms)</span>
								<input id="schedulerfetchperiod" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span> 
							&nbsp;
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="max message fetching count for one fetching step">
								<span class="add-on">Max Rows</span>
								<input id="schedulerfetchmaxrows" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span> 
							&nbsp;
							<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="max count of delivering Activities that are possible at the same time">
								<span class="add-on">Max Activity Count</span>
								<input id="schedulerfetchmaxactivity" type="text" class="input-mini" style="width: 120px; margin-right: 12px; text-align: center;" value="0" />
							</span> 
                        </div>                        
					</div>	
					</span>					 
				</p>	
				<script type="text/javascript">
					$('#login-settings-error .close').on("click", function(e) {
					    $(this).parent().hide();
					});
				
					$(document).ready(function () {												
						mbeanSearch="com.telscale.smsc:layer=SmscPropertiesManagement,name=SmscManagement";
						var mbean;
						$.ajax({
							dataType: "json",
							url: window.jolokiaProtocol + "//" + window.jolokiaAddress + ":" + window.jolokiaPort + "/jolokia/search/" + mbeanSearch
						})
						.done(function(html) {
							if (html.error) {
								logToConsole("ERROR", html.error);
							}
							else {			
								mbean = html.value[0];
								var j4p = new Jolokia({url: window.jolokiaProtocol + "//" + window.jolokiaAddress + ":" + window.jolokiaPort + "/jolokia/" });
								
								
								var propdefaultvalidityhrs = j4p.getAttribute(mbean, "DefaultValidityPeriodHours",{method: "post"});
								var propmaxvalidityhrs = j4p.getAttribute(mbean, "MaxValidityPeriodHours",{method: "post"});
								var propdefaultton = j4p.getAttribute(mbean, "DefaultTon",{method: "post"});
								var propdefaultnpi = j4p.getAttribute(mbean, "DefaultNpi",{method: "post"});
								
								var esmedefaultclustername = j4p.getAttribute(mbean, "DefaultClusterName",{method: "post"});
								
								var propsubbusduedel = j4p.getAttribute(mbean, "SubscriberBusyDueDelay",{method: "post"});
								var propfirduedel = j4p.getAttribute(mbean, "FirstDueDelay",{method: "post"});
								var propsecduedel = j4p.getAttribute(mbean, "SecondDueDelay",{method: "post"});
								var propmaxduedel = j4p.getAttribute(mbean, "MaxDueDelay",{method: "post"});
								
								var duedelaymultiplicator = j4p.getAttribute(mbean, "DueDelayMultiplicator",{method: "post"});
								
								$("#propdefaultvalidityhrs").val(propdefaultvalidityhrs);
								$("#propmaxvalidityhrs").val(propmaxvalidityhrs);
								$("#propdefaultton").val(propdefaultton);
								$("#propdefaultnpi").val(propdefaultnpi);
								
								$("#esmedefaultclustername").val(esmedefaultclustername);
								
								$("#propsubbusduedel").val(propsubbusduedel);
								$("#propfirduedel").val(propfirduedel);
								$("#propsecduedel").val(propsecduedel);
								$("#propmaxduedel").val(propmaxduedel);
								
								$("#duedelaymultiplicator").val(duedelaymultiplicator);
								
								var ussdgt = j4p.getAttribute(mbean, "ServiceCenterGt",{method: "post"});
								var ussdssn = j4p.getAttribute(mbean, "ServiceCenterSsn",{method: "post"});
								var hlrssn = j4p.getAttribute(mbean, "HlrSsn",{method: "post"});
								var mscssn = j4p.getAttribute(mbean, "MscSsn",{method: "post"});
								var maxmapv = j4p.getAttribute(mbean, "MaxMapVersion",{method: "post"});
								
								
								$("#ussdgt").val(ussdgt);
								$("#ussdssn").val(ussdssn);
								$("#hlrssn").val(hlrssn);
								$("#mscssn").val(mscssn);
								$("#maxmapv").val(maxmapv);
								
								
								var hosts = j4p.getAttribute(mbean, "Hosts",{method: "post"});
								var hostportarr = hosts.split(":");
								var cassandrahost = hostportarr[0] 
								var cassandraport = hostportarr[1]
								var cassandrakeyspace = j4p.getAttribute(mbean, "KeyspaceName",{method: "post"});
								
								
								$("#cassandrahost").val(cassandrahost);
								$("#cassandraport").val(cassandraport);
								$("#cassandrakeyspace").val(cassandrakeyspace);
								
								var schedulerfetchperiod = j4p.getAttribute(mbean, "FetchPeriod",{method: "post"});
								var schedulerfetchmaxrows = j4p.getAttribute(mbean, "FetchMaxRows",{method: "post"});
								var schedulerfetchmaxactivity = j4p.getAttribute(mbean, "MaxActivityCount",{method: "post"});
								
								
								$("#schedulerfetchperiod").val(schedulerfetchperiod);
								$("#schedulerfetchmaxrows").val(schedulerfetchmaxrows);
								$("#schedulerfetchmaxactivity").val(schedulerfetchmaxactivity);								
								
							}
						})
						.fail(function() {
							logToConsole("ERROR", "Failure trying to communicate with the SMSC Gateway. Please try again later.");
						})
	    			});
					
					function applyServerSettings() {
						var formInvalid = false;
						
						var propdefaultvalidityhrs = $("#propdefaultvalidityhrs").val();
						if(propdefaultvalidityhrs.trim() == "") {
			    			$("#propdefaultvalidityhrs").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propdefaultvalidityhrs").hasClass("required")) {
			    			$("#propdefaultvalidityhrs").removeClass("required");		
			    		}
						
						var propmaxvalidityhrs = $("#propmaxvalidityhrs").val();
						if(propmaxvalidityhrs.trim() == "") {
			    			$("#propmaxvalidityhrs").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propmaxvalidityhrs").hasClass("required")) {
			    			$("#propmaxvalidityhrs").removeClass("required");		
			    		}
						
						var propdefaultton = $("#propdefaultton").val();
						if(propdefaultton.trim() == "") {
			    			$("#propdefaultton").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propdefaultton").hasClass("required")) {
			    			$("#propdefaultton").removeClass("required");		
			    		}
						
						var propdefaultnpi = $("#propdefaultnpi").val();
						if(propdefaultnpi.trim() == "") {
			    			$("#propdefaultnpi").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propdefaultnpi").hasClass("required")) {
			    			$("#propdefaultnpi").removeClass("required");		
			    		}
						
						var propsubbusduedel = $("#propsubbusduedel").val();
						if(propsubbusduedel.trim() == "") {
			    			$("#propsubbusduedel").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propsubbusduedel").hasClass("required")) {
			    			$("#propsubbusduedel").removeClass("required");		
			    		}
						
						var propfirduedel = $("#propfirduedel").val();
						if(propfirduedel.trim() == "") {
			    			$("#propfirduedel").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propfirduedel").hasClass("required")) {
			    			$("#propfirduedel").removeClass("required");		
			    		}
						
						var propsecduedel = $("#propsecduedel").val();
						if(propsecduedel.trim() == "") {
			    			$("#propsecduedel").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propsecduedel").hasClass("required")) {
			    			$("#propsecduedel").removeClass("required");		
			    		}
						
						var propmaxduedel = $("#propmaxduedel").val();
						if(propmaxduedel.trim() == "") {
			    			$("#propmaxduedel").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#propmaxduedel").hasClass("required")) {
			    			$("#propmaxduedel").removeClass("required");		
			    		}
						
						
						var cassandrahost = $("#cassandrahost").val();
						if(cassandrahost.trim() == "") {
			    			$("#cassandrahost").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#cassandrahost").hasClass("required")) {
			    			$("#cassandrahost").removeClass("required");		
			    		}
						
						var cassandraport = $("#cassandraport").val();
						if(cassandraport.trim() == "") {
			    			$("#cassandraport").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#cassandraport").hasClass("required")) {
			    			$("#cassandraport").removeClass("required");		
			    		}
						
						var hosts = cassandrahost + ":" + cassandraport;
						
						var cassandrakeyspace = $("#cassandrakeyspace").val();
						if(cassandrakeyspace.trim() == "") {
			    			$("#cassandrakeyspace").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#cassandrakeyspace").hasClass("required")) {
			    			$("#cassandrakeyspace").removeClass("required");		
			    		}
						
						
						var ussdgt = $("#ussdgt").val();
						if(ussdgt.trim() == "") {
			    			$("#ussdgt").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#ussdgt").hasClass("required")) {
			    			$("#ussdgt").removeClass("required");		
			    		}
						
						var ussdssn = $("#ussdssn").val();
						if(ussdssn.trim() == "") {
			    			$("#ussdssn").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#ussdssn").hasClass("required")) {
			    			$("#ussdssn").removeClass("required");		
			    		}		
						
						var hlrssn = $("#hlrssn").val();
						if(hlrssn.trim() == "") {
			    			$("#hlrssn").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#hlrssn").hasClass("required")) {
			    			$("#hlrssn").removeClass("required");		
			    		}	
						
						var mscssn = $("#mscssn").val();
						if(mscssn.trim() == "") {
			    			$("#mscssn").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#mscssn").hasClass("required")) {
			    			$("#mscssn").removeClass("required");		
			    		}
						
						var maxmapv = $("#maxmapv").val();
						if(maxmapv.trim() == "") {
			    			$("#maxmapv").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#maxmapv").hasClass("required")) {
			    			$("#maxmapv").removeClass("required");		
			    		}
						
						var schedulerfetchperiod = $("#schedulerfetchperiod").val();
						if(schedulerfetchperiod.trim() == "") {
			    			$("#schedulerfetchperiod").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#schedulerfetchperiod").hasClass("required")) {
			    			$("#schedulerfetchperiod").removeClass("required");		
			    		}
						
						var schedulerfetchmaxrows = $("#schedulerfetchmaxrows").val();
						if(schedulerfetchmaxrows.trim() == "") {
			    			$("#schedulerfetchmaxrows").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#schedulerfetchmaxrows").hasClass("required")) {
			    			$("#schedulerfetchmaxrows").removeClass("required");		
			    		}
						
						var schedulerfetchmaxactivity = $("#schedulerfetchmaxactivity").val();
						if(schedulerfetchmaxactivity.trim() == "") {
			    			$("#schedulerfetchmaxactivity").addClass("required");					    			
			    			formInvalid = true;
			    		} else if($("#schedulerfetchmaxactivity").hasClass("required")) {
			    			$("#schedulerfetchmaxactivity").removeClass("required");		
			    		}
						
						if(formInvalid) {
							$("#login-settings-error").show();
							logToConsole("ERROR", "Some Fields are not correctly filled out, please double check the settings !");
							return false;
						} else {
							$("#login-settings-error").hide();
						}
						
						mbeanSearch="com.telscale.smsc:layer=SmscPropertiesManagement,name=SmscManagement";
						var mbean;
						$.ajax({
							dataType: "json",
							url: window.jolokiaProtocol + "//" + window.jolokiaAddress + ":" + window.jolokiaPort + "/jolokia/search/" + mbeanSearch
						})
						.done(function(html) {
							if (html.error) {
								logToConsole("ERROR", html.error);
							}
							else {			
								mbean = html.value[0];
								var j4p = new Jolokia({url: window.jolokiaProtocol + "//" + window.jolokiaAddress + ":" + window.jolokiaPort + "/jolokia/" });
								
								j4p.setAttribute(mbean, "DefaultValidityPeriodHours",propdefaultvalidityhrs,{method: "post"});
								j4p.setAttribute(mbean, "MaxValidityPeriodHours",propmaxvalidityhrs,{method: "post"});
								j4p.setAttribute(mbean, "DefaultTon",propdefaultton,{method: "post"});
								j4p.setAttribute(mbean, "DefaultNpi",propdefaultnpi,{method: "post"});
								j4p.setAttribute(mbean, "SubscriberBusyDueDelay",propsubbusduedel,{method: "post"});
								j4p.setAttribute(mbean, "FirstDueDelay",propfirduedel,{method: "post"});
								j4p.setAttribute(mbean, "SecondDueDelay",propsecduedel,{method: "post"});
								j4p.setAttribute(mbean, "MaxDueDelay",propmaxduedel,{method: "post"});
								
								
								j4p.setAttribute(mbean, "Hosts",hosts,{method: "post"});
								j4p.setAttribute(mbean, "KeyspaceName",cassandrakeyspace,{method: "post"});
								
								j4p.setAttribute(mbean, "ServiceCenterGt",ussdgt,{method: "post"});	
								j4p.setAttribute(mbean, "ServiceCenterSsn",ussdssn,{method: "post"});	
								j4p.setAttribute(mbean, "HlrSsn",hlrssn,{method: "post"});	
								j4p.setAttribute(mbean, "MscSsn",mscssn,{method: "post"});	
								j4p.setAttribute(mbean, "MaxMapVersion",maxmapv,{method: "post"});	
								
								j4p.setAttribute(mbean, "FetchPeriod",schedulerfetchperiod,{method: "post"});
								j4p.setAttribute(mbean, "FetchMaxRows",schedulerfetchmaxrows,{method: "post"});
								j4p.setAttribute(mbean, "MaxActivityCount",schedulerfetchmaxactivity,{method: "post"});
								
								logToConsole("INFO", "SMSC Gateway Proerties successfully updated.");
							}
						})
						.fail(function() {
							logToConsole("ERROR", "Failure trying to communicate with the Telscale SMSC Gateway. Please try again later.");
						})						
					}
					</script>
